
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-8.5.10">
    
    
      
        <title>Architectures - PrismToolBox</title>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../../../../../assets/stylesheets/palette.2505c338.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prismtoolbox.nucleiseg.models.sop.architectures.ResnetBlock" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../../.." title="PrismToolBox" class="md-header__button md-logo" aria-label="PrismToolBox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PrismToolBox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architectures
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/gustaveroussy/PrismToolBox" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gustaveroussy/PrismToolBox
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../api_index/" class="md-tabs__link">
        API
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../../../cli/preprocessing/" class="md-tabs__link">
        CLI
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../../../examples/index.md" class="md-tabs__link">
      Examples
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../../.." title="PrismToolBox" class="md-nav__button md-logo" aria-label="PrismToolBox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    PrismToolBox
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/gustaveroussy/PrismToolBox" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gustaveroussy/PrismToolBox
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../api_index/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2">
          prismtoolbox.wsicore
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="prismtoolbox.wsicore" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          prismtoolbox.wsicore
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../wsicore/wsi/" class="md-nav__link">
        prismtoolbox.wsicore.wsi
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../wsicore/core_utils/" class="md-nav__link">
        prismtoolbox.wsicore.core_utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_3">
          prismtoolbox.wsiemb
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="prismtoolbox.wsiemb" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          prismtoolbox.wsiemb
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../wsiemb/embedder/" class="md-nav__link">
        prismtoolbox.wsiemb.embedder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../wsiemb/processing/" class="md-nav__link">
        prismtoolbox.wsiemb.processing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../wsiemb/emb_utils/" class="md-nav__link">
        prismtoolbox.wsiemb.emb_utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../segmenter/" class="md-nav__link">
        prismtoolbox.nucleiseg
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          CLI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CLI" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          CLI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../cli/preprocessing/" class="md-nav__link">
        Preprocessing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../../examples/index.md" class="md-nav__link">
        Examples
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/gustaveroussy/PrismToolBox/edit/master/docs/src/prismtoolbox/nucleiseg/models/sop/architectures.py" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>Architectures</h1>

<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="prismtoolbox.nucleiseg.models.sop.architectures.ResnetBlock" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code class="highlight language-python"><span class="n">ResnetBlock</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">padding_type</span><span class="p">,</span> <span class="n">norm_layer</span><span class="p">,</span> <span class="n">use_dropout</span><span class="p">,</span> <span class="n">use_bias</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="torch.nn.Module">Module</span></code></p>

  
      <p>Define a Resnet block</p>
  
      <p>Initialize the Resnet block
A resnet block is a conv block with skip connections
We construct a conv block with build_conv_block function,
and implement skip connections in <forward> function.
Original Resnet paper: https://arxiv.org/pdf/1512.03385.pdf</p>

                <details class="quote">
                  <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">padding_type</span><span class="p">,</span> <span class="n">norm_layer</span><span class="p">,</span> <span class="n">use_dropout</span><span class="p">,</span> <span class="n">use_bias</span><span class="p">):</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the Resnet block</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    A resnet block is a conv block with skip connections</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">    We construct a conv block with build_conv_block function,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">    and implement skip connections in &lt;forward&gt; function.</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">    Original Resnet paper: https://arxiv.org/pdf/1512.03385.pdf</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">ResnetBlock</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">conv_block</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_conv_block</span><span class="p">(</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="n">dim</span><span class="p">,</span> <span class="n">padding_type</span><span class="p">,</span> <span class="n">norm_layer</span><span class="p">,</span> <span class="n">use_dropout</span><span class="p">,</span> <span class="n">use_bias</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.nucleiseg.models.sop.architectures.ResnetBlock.build_conv_block" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">build_conv_block</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">padding_type</span><span class="p">,</span> <span class="n">norm_layer</span><span class="p">,</span> <span class="n">use_dropout</span><span class="p">,</span> <span class="n">use_bias</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Construct a convolutional block.
Parameters:
    dim (int)           -- the number of channels in the conv layer.
    padding_type (str)  -- the name of padding layer: reflect | replicate | zero
    norm_layer          -- normalization layer
    use_dropout (bool)  -- if use dropout layers.
    use_bias (bool)     -- if the conv layer uses bias or not
Returns a conv block (with a conv layer, a normalization layer, and a non-linearity layer (ReLU))</p>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="k">def</span> <span class="nf">build_conv_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">padding_type</span><span class="p">,</span> <span class="n">norm_layer</span><span class="p">,</span> <span class="n">use_dropout</span><span class="p">,</span> <span class="n">use_bias</span><span class="p">):</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a convolutional block.</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        dim (int)           -- the number of channels in the conv layer.</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        padding_type (str)  -- the name of padding layer: reflect | replicate | zero</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        norm_layer          -- normalization layer</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        use_dropout (bool)  -- if use dropout layers.</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">        use_bias (bool)     -- if the conv layer uses bias or not</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">    Returns a conv block (with a conv layer, a normalization layer, and a non-linearity layer (ReLU))</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="n">conv_block</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="k">if</span> <span class="n">padding_type</span> <span class="o">==</span> <span class="s2">&quot;reflect&quot;</span><span class="p">:</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">conv_block</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">ReflectionPad2d</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="k">elif</span> <span class="n">padding_type</span> <span class="o">==</span> <span class="s2">&quot;replicate&quot;</span><span class="p">:</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="n">conv_block</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">ReplicationPad2d</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="k">elif</span> <span class="n">padding_type</span> <span class="o">==</span> <span class="s2">&quot;zero&quot;</span><span class="p">:</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>        <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;padding [</span><span class="si">%s</span><span class="s2">] is not implemented&quot;</span> <span class="o">%</span> <span class="n">padding_type</span><span class="p">)</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="n">conv_block</span> <span class="o">+=</span> <span class="p">[</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">),</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">norm_layer</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="p">]</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="k">if</span> <span class="n">use_dropout</span><span class="p">:</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="n">conv_block</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)]</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="k">if</span> <span class="n">padding_type</span> <span class="o">==</span> <span class="s2">&quot;reflect&quot;</span><span class="p">:</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">conv_block</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">ReflectionPad2d</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="k">elif</span> <span class="n">padding_type</span> <span class="o">==</span> <span class="s2">&quot;replicate&quot;</span><span class="p">:</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>        <span class="n">conv_block</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">ReplicationPad2d</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="k">elif</span> <span class="n">padding_type</span> <span class="o">==</span> <span class="s2">&quot;zero&quot;</span><span class="p">:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;padding [</span><span class="si">%s</span><span class="s2">] is not implemented&quot;</span> <span class="o">%</span> <span class="n">padding_type</span><span class="p">)</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>    <span class="n">conv_block</span> <span class="o">+=</span> <span class="p">[</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">),</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>        <span class="n">norm_layer</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="p">]</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="k">return</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">conv_block</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.nucleiseg.models.sop.architectures.ResnetBlock.forward" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Forward function (with skip connections)</p>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Forward function (with skip connections)&quot;&quot;&quot;</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">conv_block</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c1"># add skip connections</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="prismtoolbox.nucleiseg.models.sop.architectures.ResnetGenerator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code class="highlight language-python"><span class="n">ResnetGenerator</span><span class="p">(</span><span class="n">input_nc</span><span class="p">,</span> <span class="n">output_nc</span><span class="p">,</span> <span class="n">ngf</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">norm_layer</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">,</span> <span class="n">use_dropout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">n_blocks</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">padding_type</span><span class="o">=</span><span class="s1">&#39;reflect&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="torch.nn.Module">Module</span></code></p>

  
      <p>Resnet-based generator that consists of Resnet blocks between a few downsampling/upsampling operations.
We adapt Torch code and idea from Justin Johnson's neural style transfer project(https://github.com/jcjohnson/fast-neural-style)</p>
  
      <p>Construct a Resnet-based generator
Parameters:
    input_nc (int)      -- the number of channels in input images
    output_nc (int)     -- the number of channels in output images
    ngf (int)           -- the number of filters in the last conv layer
    norm_layer          -- normalization layer
    use_dropout (bool)  -- if use dropout layers
    n_blocks (int)      -- the number of ResNet blocks
    padding_type (str)  -- the name of padding layer in conv layers: reflect | replicate | zero</p>

                <details class="quote">
                  <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>    <span class="n">input_nc</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="n">output_nc</span><span class="p">,</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="n">ngf</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>    <span class="n">norm_layer</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">,</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="n">use_dropout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="n">n_blocks</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="n">padding_type</span><span class="o">=</span><span class="s2">&quot;reflect&quot;</span><span class="p">,</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="p">):</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a Resnet-based generator</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        input_nc (int)      -- the number of channels in input images</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        output_nc (int)     -- the number of channels in output images</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a><span class="sd">        ngf (int)           -- the number of filters in the last conv layer</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        norm_layer          -- normalization layer</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">        use_dropout (bool)  -- if use dropout layers</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">        n_blocks (int)      -- the number of ResNet blocks</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">        padding_type (str)  -- the name of padding layer in conv layers: reflect | replicate | zero</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="k">assert</span> <span class="n">n_blocks</span> <span class="o">&gt;=</span> <span class="mi">0</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">ResnetGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">norm_layer</span><span class="p">)</span> <span class="o">==</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">:</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="n">use_bias</span> <span class="o">=</span> <span class="n">norm_layer</span><span class="o">.</span><span class="n">func</span> <span class="o">==</span> <span class="n">nn</span><span class="o">.</span><span class="n">InstanceNorm2d</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="n">use_bias</span> <span class="o">=</span> <span class="n">norm_layer</span> <span class="o">==</span> <span class="n">nn</span><span class="o">.</span><span class="n">InstanceNorm2d</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="n">model</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="n">nn</span><span class="o">.</span><span class="n">ReflectionPad2d</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">input_nc</span><span class="p">,</span> <span class="n">ngf</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">),</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="n">norm_layer</span><span class="p">(</span><span class="n">ngf</span><span class="p">),</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>        <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>    <span class="p">]</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="n">n_downsampling</span> <span class="o">=</span> <span class="mi">2</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_downsampling</span><span class="p">):</span>  <span class="c1"># add downsampling layers</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">mult</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">i</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="n">model</span> <span class="o">+=</span> <span class="p">[</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>            <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>                <span class="n">ngf</span> <span class="o">*</span> <span class="n">mult</span><span class="p">,</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>                <span class="n">ngf</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>                <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>                <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>                <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>                <span class="n">bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="p">),</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="n">norm_layer</span><span class="p">(</span><span class="n">ngf</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">*</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="p">]</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="n">mult</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">n_downsampling</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_blocks</span><span class="p">):</span>  <span class="c1"># add ResNet blocks</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="n">model</span> <span class="o">+=</span> <span class="p">[</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="n">ResnetBlock</span><span class="p">(</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>                <span class="n">ngf</span> <span class="o">*</span> <span class="n">mult</span><span class="p">,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="n">padding_type</span><span class="o">=</span><span class="n">padding_type</span><span class="p">,</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>                <span class="n">norm_layer</span><span class="o">=</span><span class="n">norm_layer</span><span class="p">,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>                <span class="n">use_dropout</span><span class="o">=</span><span class="n">use_dropout</span><span class="p">,</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>                <span class="n">use_bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="p">)</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>        <span class="p">]</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_downsampling</span><span class="p">):</span>  <span class="c1"># add upsampling layers</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="n">mult</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="p">(</span><span class="n">n_downsampling</span> <span class="o">-</span> <span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">model</span> <span class="o">+=</span> <span class="p">[</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose2d</span><span class="p">(</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>                <span class="n">ngf</span> <span class="o">*</span> <span class="n">mult</span><span class="p">,</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                <span class="nb">int</span><span class="p">(</span><span class="n">ngf</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>                <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>                <span class="n">output_padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>                <span class="n">bias</span><span class="o">=</span><span class="n">use_bias</span><span class="p">,</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="p">),</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="n">norm_layer</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ngf</span> <span class="o">*</span> <span class="n">mult</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)),</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="p">]</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="n">model</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">ReflectionPad2d</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="n">model</span> <span class="o">+=</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">ngf</span><span class="p">,</span> <span class="n">output_nc</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="c1"># Model += [nn.Tanh()]</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">model</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.nucleiseg.models.sop.architectures.ResnetGenerator.forward" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Standard forward</p>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Standard forward&quot;&quot;&quot;</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="prismtoolbox.nucleiseg.models.sop.architectures.UnetGenerator" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code class="highlight language-python"><span class="n">UnetGenerator</span><span class="p">(</span><span class="n">input_nc</span><span class="p">,</span> <span class="n">output_nc</span><span class="p">,</span> <span class="n">num_downs</span><span class="p">,</span> <span class="n">ngf</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">norm_layer</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">,</span> <span class="n">use_dropout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropout_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bias_last_conv</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="torch.nn.Module">Module</span></code></p>

  
      <p>Create a Unet-based generator</p>
  
      <p>Construct a Unet generator
Parameters:
    input_nc (int)  -- the number of channels in input images
    output_nc (int) -- the number of channels in output images
    num_downs (int) -- the number of downsamplings in UNet. For example, # if |num_downs| == 7,
                        image of size 128x128 will become of size 1x1 # at the bottleneck
    ngf (int)       -- the number of filters in the last conv layer
    norm_layer      -- normalization layer
We construct the U-Net from the innermost layer to the outermost layer.
It is a recursive process.</p>

                <details class="quote">
                  <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="n">input_nc</span><span class="p">,</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="n">output_nc</span><span class="p">,</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="n">num_downs</span><span class="p">,</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="n">ngf</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="n">norm_layer</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">,</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="n">use_dropout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>    <span class="n">dropout_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="n">bias_last_conv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="p">):</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a Unet generator</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a><span class="sd">        input_nc (int)  -- the number of channels in input images</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">        output_nc (int) -- the number of channels in output images</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">        num_downs (int) -- the number of downsamplings in UNet. For example, # if |num_downs| == 7,</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="sd">                            image of size 128x128 will become of size 1x1 # at the bottleneck</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">        ngf (int)       -- the number of filters in the last conv layer</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">        norm_layer      -- normalization layer</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    We construct the U-Net from the innermost layer to the outermost layer.</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">    It is a recursive process.</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">UnetGenerator</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="c1"># construct unet structure</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="n">unet_block</span> <span class="o">=</span> <span class="n">UnetSkipConnectionBlock</span><span class="p">(</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="n">ngf</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="n">ngf</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="n">input_nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">submodule</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="n">norm_layer</span><span class="o">=</span><span class="n">norm_layer</span><span class="p">,</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>        <span class="n">innermost</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="p">)</span>  <span class="c1"># add the innermost layer</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_downs</span> <span class="o">-</span> <span class="mi">5</span><span class="p">):</span>  <span class="c1"># add intermediate layers with ngf * 8 filters</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>        <span class="n">unet_block</span> <span class="o">=</span> <span class="n">UnetSkipConnectionBlock</span><span class="p">(</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>            <span class="n">ngf</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>            <span class="n">ngf</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>            <span class="n">input_nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="n">submodule</span><span class="o">=</span><span class="n">unet_block</span><span class="p">,</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>            <span class="n">norm_layer</span><span class="o">=</span><span class="n">norm_layer</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>            <span class="n">use_dropout</span><span class="o">=</span><span class="n">use_dropout</span><span class="p">,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>            <span class="n">dropout_value</span><span class="o">=</span><span class="n">dropout_value</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="p">)</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="c1"># gradually reduce the number of filters from ngf * 8 to ngf</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="n">unet_block</span> <span class="o">=</span> <span class="n">UnetSkipConnectionBlock</span><span class="p">(</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="n">ngf</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">ngf</span> <span class="o">*</span> <span class="mi">8</span><span class="p">,</span> <span class="n">input_nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">submodule</span><span class="o">=</span><span class="n">unet_block</span><span class="p">,</span> <span class="n">norm_layer</span><span class="o">=</span><span class="n">norm_layer</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="p">)</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>    <span class="n">unet_block</span> <span class="o">=</span> <span class="n">UnetSkipConnectionBlock</span><span class="p">(</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="n">ngf</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">ngf</span> <span class="o">*</span> <span class="mi">4</span><span class="p">,</span> <span class="n">input_nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">submodule</span><span class="o">=</span><span class="n">unet_block</span><span class="p">,</span> <span class="n">norm_layer</span><span class="o">=</span><span class="n">norm_layer</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="p">)</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>    <span class="n">unet_block</span> <span class="o">=</span> <span class="n">UnetSkipConnectionBlock</span><span class="p">(</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="n">ngf</span><span class="p">,</span> <span class="n">ngf</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">input_nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">submodule</span><span class="o">=</span><span class="n">unet_block</span><span class="p">,</span> <span class="n">norm_layer</span><span class="o">=</span><span class="n">norm_layer</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>    <span class="p">)</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">UnetSkipConnectionBlock</span><span class="p">(</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="n">output_nc</span><span class="p">,</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">ngf</span><span class="p">,</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="n">input_nc</span><span class="o">=</span><span class="n">input_nc</span><span class="p">,</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="n">submodule</span><span class="o">=</span><span class="n">unet_block</span><span class="p">,</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="n">outermost</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="n">norm_layer</span><span class="o">=</span><span class="n">norm_layer</span><span class="p">,</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="n">bias_last_conv</span><span class="o">=</span><span class="n">bias_last_conv</span><span class="p">,</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="p">)</span>  <span class="c1"># add the outermost layer</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.nucleiseg.models.sop.architectures.UnetGenerator.forward" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Standard forward</p>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-405" name="__codelineno-0-405"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">input</span><span class="p">):</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Standard forward&quot;&quot;&quot;</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="prismtoolbox.nucleiseg.models.sop.architectures.UnetSkipConnectionBlock" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code class="highlight language-python"><span class="n">UnetSkipConnectionBlock</span><span class="p">(</span><span class="n">outer_nc</span><span class="p">,</span> <span class="n">inner_nc</span><span class="p">,</span> <span class="n">input_nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">submodule</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">outermost</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">innermost</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">norm_layer</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">,</span> <span class="n">use_dropout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropout_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">bias_last_conv</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><span title="torch.nn.Module">Module</span></code></p>

  
      <p>Defines the Unet submodule with skip connection.
X -------------------identity----------------------
|-- downsampling -- |submodule| -- upsampling --|</p>
  
      <p>Construct a Unet submodule with skip connections.
Parameters:
    outer_nc (int) -- the number of filters in the outer conv layer
    inner_nc (int) -- the number of filters in the inner conv layer
    input_nc (int) -- the number of channels in input images/features
    submodule (UnetSkipConnectionBlock) -- previously defined submodules
    outermost (bool)    -- if this module is the outermost module
    innermost (bool)    -- if this module is the innermost module
    norm_layer          -- normalization layer
    use_dropout (bool)  -- if use dropout layers.</p>

                <details class="quote">
                  <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>    <span class="n">outer_nc</span><span class="p">,</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>    <span class="n">inner_nc</span><span class="p">,</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>    <span class="n">input_nc</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>    <span class="n">submodule</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>    <span class="n">outermost</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="n">innermost</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="n">norm_layer</span><span class="o">=</span><span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">,</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>    <span class="n">use_dropout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>    <span class="n">dropout_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="n">bias_last_conv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a><span class="p">):</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct a Unet submodule with skip connections.</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">        outer_nc (int) -- the number of filters in the outer conv layer</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a><span class="sd">        inner_nc (int) -- the number of filters in the inner conv layer</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a><span class="sd">        input_nc (int) -- the number of channels in input images/features</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a><span class="sd">        submodule (UnetSkipConnectionBlock) -- previously defined submodules</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a><span class="sd">        outermost (bool)    -- if this module is the outermost module</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a><span class="sd">        innermost (bool)    -- if this module is the innermost module</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a><span class="sd">        norm_layer          -- normalization layer</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a><span class="sd">        use_dropout (bool)  -- if use dropout layers.</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>    <span class="nb">super</span><span class="p">(</span><span class="n">UnetSkipConnectionBlock</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">outermost</span> <span class="o">=</span> <span class="n">outermost</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">norm_layer</span><span class="p">)</span> <span class="o">==</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="n">use_bias</span> <span class="o">=</span> <span class="n">norm_layer</span><span class="o">.</span><span class="n">func</span> <span class="o">==</span> <span class="n">nn</span><span class="o">.</span><span class="n">InstanceNorm2d</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="n">use_bias</span> <span class="o">=</span> <span class="n">norm_layer</span> <span class="o">==</span> <span class="n">nn</span><span class="o">.</span><span class="n">InstanceNorm2d</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="k">if</span> <span class="n">input_nc</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="n">input_nc</span> <span class="o">=</span> <span class="n">outer_nc</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>    <span class="n">downconv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Conv2d</span><span class="p">(</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="n">input_nc</span><span class="p">,</span> <span class="n">inner_nc</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">use_bias</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="p">)</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>    <span class="n">downrelu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LeakyReLU</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>    <span class="n">downnorm</span> <span class="o">=</span> <span class="n">norm_layer</span><span class="p">(</span><span class="n">inner_nc</span><span class="p">)</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>    <span class="n">uprelu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>    <span class="n">upnorm</span> <span class="o">=</span> <span class="n">norm_layer</span><span class="p">(</span><span class="n">outer_nc</span><span class="p">)</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>    <span class="k">if</span> <span class="n">outermost</span><span class="p">:</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="n">upconv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose2d</span><span class="p">(</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="n">inner_nc</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="n">outer_nc</span><span class="p">,</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>            <span class="n">kernel_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>            <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>            <span class="n">bias</span><span class="o">=</span><span class="n">bias_last_conv</span><span class="p">,</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="p">)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>        <span class="n">down</span> <span class="o">=</span> <span class="p">[</span><span class="n">downconv</span><span class="p">]</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="n">up</span> <span class="o">=</span> <span class="p">[</span><span class="n">uprelu</span><span class="p">,</span> <span class="n">upconv</span><span class="p">]</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">down</span> <span class="o">+</span> <span class="p">[</span><span class="n">submodule</span><span class="p">]</span> <span class="o">+</span> <span class="n">up</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="k">elif</span> <span class="n">innermost</span><span class="p">:</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="n">upconv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose2d</span><span class="p">(</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>            <span class="n">inner_nc</span><span class="p">,</span> <span class="n">outer_nc</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">use_bias</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="p">)</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="n">down</span> <span class="o">=</span> <span class="p">[</span><span class="n">downrelu</span><span class="p">,</span> <span class="n">downconv</span><span class="p">]</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="n">up</span> <span class="o">=</span> <span class="p">[</span><span class="n">uprelu</span><span class="p">,</span> <span class="n">upconv</span><span class="p">,</span> <span class="n">upnorm</span><span class="p">]</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="n">model</span> <span class="o">=</span> <span class="n">down</span> <span class="o">+</span> <span class="n">up</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="n">upconv</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ConvTranspose2d</span><span class="p">(</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>            <span class="n">inner_nc</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">outer_nc</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="n">use_bias</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="p">)</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">down</span> <span class="o">=</span> <span class="p">[</span><span class="n">downrelu</span><span class="p">,</span> <span class="n">downconv</span><span class="p">,</span> <span class="n">downnorm</span><span class="p">]</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="n">up</span> <span class="o">=</span> <span class="p">[</span><span class="n">uprelu</span><span class="p">,</span> <span class="n">upconv</span><span class="p">,</span> <span class="n">upnorm</span><span class="p">]</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="k">if</span> <span class="n">use_dropout</span><span class="p">:</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">down</span> <span class="o">+</span> <span class="p">[</span><span class="n">submodule</span><span class="p">]</span> <span class="o">+</span> <span class="n">up</span> <span class="o">+</span> <span class="p">[</span><span class="n">nn</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="n">dropout_value</span><span class="p">)]</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>            <span class="n">model</span> <span class="o">=</span> <span class="n">down</span> <span class="o">+</span> <span class="p">[</span><span class="n">submodule</span><span class="p">]</span> <span class="o">+</span> <span class="n">up</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">model</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>



<div class="doc doc-object doc-function">



<h2 id="prismtoolbox.nucleiseg.models.sop.architectures.define_G" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>          <code class="highlight language-python"><span class="n">define_G</span><span class="p">(</span><span class="n">input_nc</span><span class="p">,</span> <span class="n">output_nc</span><span class="p">,</span> <span class="n">ngf</span><span class="p">,</span> <span class="n">netG</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="s1">&#39;batch&#39;</span><span class="p">,</span> <span class="n">use_dropout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">dropout_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">init_type</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">init_gain</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">gpu_ids</span><span class="o">=</span><span class="p">[],</span> <span class="n">bias_last_conv</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Create a generator
Parameters:
    input_nc (int) -- the number of channels in input images
    output_nc (int) -- the number of channels in output images
    ngf (int) -- the number of filters in the last conv layer
    netG (str) -- the architecture's name: resnet_9blocks | resnet_6blocks | unet_256 | unet_128
    norm (str) -- the name of normalization layers used in the network: batch | instance | none
    use_dropout (bool) -- if use dropout layers.
    init_type (str)    -- the name of our initialization method.
    init_gain (float)  -- scaling factor for normal, xavier and orthogonal.
    gpu_ids (int list) -- which GPUs the network runs on: e.g., 0,1,2
Returns a generator
Our current implementation provides two types of generators:
    U-Net: [unet_128] (for 128x128 input images) and [unet_256] (for 256x256 input images)
    The original U-Net paper: https://arxiv.org/abs/1505.04597
    Resnet-based generator: [resnet_6blocks] (with 6 Resnet blocks) and [resnet_9blocks] (with 9 Resnet blocks)
    Resnet-based generator consists of several Resnet blocks between a few downsampling/upsampling operations.
    We adapt Torch code from Justin Johnson's neural style transfer project (https://github.com/jcjohnson/fast-neural-style).
The generator has been initialized by <init_net>. It uses RELU for non-linearity.</p>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="k">def</span> <span class="nf">define_G</span><span class="p">(</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="n">input_nc</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">output_nc</span><span class="p">,</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">ngf</span><span class="p">,</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="n">netG</span><span class="p">,</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">norm</span><span class="o">=</span><span class="s2">&quot;batch&quot;</span><span class="p">,</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">use_dropout</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="n">dropout_value</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">init_type</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="n">init_gain</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">gpu_ids</span><span class="o">=</span><span class="p">[],</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="n">bias_last_conv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="p">):</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a generator</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        input_nc (int) -- the number of channels in input images</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        output_nc (int) -- the number of channels in output images</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        ngf (int) -- the number of filters in the last conv layer</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        netG (str) -- the architecture&#39;s name: resnet_9blocks | resnet_6blocks | unet_256 | unet_128</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        norm (str) -- the name of normalization layers used in the network: batch | instance | none</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        use_dropout (bool) -- if use dropout layers.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        init_type (str)    -- the name of our initialization method.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        init_gain (float)  -- scaling factor for normal, xavier and orthogonal.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        gpu_ids (int list) -- which GPUs the network runs on: e.g., 0,1,2</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">    Returns a generator</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Our current implementation provides two types of generators:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        U-Net: [unet_128] (for 128x128 input images) and [unet_256] (for 256x256 input images)</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        The original U-Net paper: https://arxiv.org/abs/1505.04597</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        Resnet-based generator: [resnet_6blocks] (with 6 Resnet blocks) and [resnet_9blocks] (with 9 Resnet blocks)</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        Resnet-based generator consists of several Resnet blocks between a few downsampling/upsampling operations.</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">        We adapt Torch code from Justin Johnson&#39;s neural style transfer project (https://github.com/jcjohnson/fast-neural-style).</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    The generator has been initialized by &lt;init_net&gt;. It uses RELU for non-linearity.</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">net</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="n">norm_layer</span> <span class="o">=</span> <span class="n">get_norm_layer</span><span class="p">(</span><span class="n">norm_type</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">if</span> <span class="n">netG</span> <span class="o">==</span> <span class="s2">&quot;resnet_9blocks&quot;</span><span class="p">:</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="n">net</span> <span class="o">=</span> <span class="n">ResnetGenerator</span><span class="p">(</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="n">input_nc</span><span class="p">,</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="n">output_nc</span><span class="p">,</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="n">ngf</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="n">norm_layer</span><span class="o">=</span><span class="n">norm_layer</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>            <span class="n">use_dropout</span><span class="o">=</span><span class="n">use_dropout</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>            <span class="n">n_blocks</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="k">elif</span> <span class="n">netG</span> <span class="o">==</span> <span class="s2">&quot;resnet_6blocks&quot;</span><span class="p">:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">net</span> <span class="o">=</span> <span class="n">ResnetGenerator</span><span class="p">(</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>            <span class="n">input_nc</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>            <span class="n">output_nc</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>            <span class="n">ngf</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>            <span class="n">norm_layer</span><span class="o">=</span><span class="n">norm_layer</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>            <span class="n">use_dropout</span><span class="o">=</span><span class="n">use_dropout</span><span class="p">,</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>            <span class="n">n_blocks</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">elif</span> <span class="n">netG</span> <span class="o">==</span> <span class="s2">&quot;unet_128&quot;</span><span class="p">:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="n">net</span> <span class="o">=</span> <span class="n">UnetGenerator</span><span class="p">(</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>            <span class="n">input_nc</span><span class="p">,</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>            <span class="n">output_nc</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>            <span class="mi">7</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>            <span class="n">ngf</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>            <span class="n">norm_layer</span><span class="o">=</span><span class="n">norm_layer</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>            <span class="n">use_dropout</span><span class="o">=</span><span class="n">use_dropout</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>            <span class="n">dropout_value</span><span class="o">=</span><span class="n">dropout_value</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>            <span class="n">bias_last_conv</span><span class="o">=</span><span class="n">bias_last_conv</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="k">elif</span> <span class="n">netG</span> <span class="o">==</span> <span class="s2">&quot;unet_256&quot;</span><span class="p">:</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="n">net</span> <span class="o">=</span> <span class="n">UnetGenerator</span><span class="p">(</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">input_nc</span><span class="p">,</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">output_nc</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="mi">8</span><span class="p">,</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">ngf</span><span class="p">,</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="n">norm_layer</span><span class="o">=</span><span class="n">norm_layer</span><span class="p">,</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">use_dropout</span><span class="o">=</span><span class="n">use_dropout</span><span class="p">,</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>            <span class="n">dropout_value</span><span class="o">=</span><span class="n">dropout_value</span><span class="p">,</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>            <span class="n">bias_last_conv</span><span class="o">=</span><span class="n">bias_last_conv</span><span class="p">,</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Generator model name [</span><span class="si">%s</span><span class="s2">] is not recognized&quot;</span> <span class="o">%</span> <span class="n">netG</span><span class="p">)</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="k">return</span> <span class="n">init_net</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">init_type</span><span class="p">,</span> <span class="n">init_gain</span><span class="p">,</span> <span class="n">gpu_ids</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="prismtoolbox.nucleiseg.models.sop.architectures.get_norm_layer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>          <code class="highlight language-python"><span class="n">get_norm_layer</span><span class="p">(</span><span class="n">norm_type</span><span class="o">=</span><span class="s1">&#39;instance&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return a normalization layer
Parameters:
    norm_type (str) -- the name of the normalization layer: batch | instance | none
For BatchNorm, we use learnable affine parameters and track running statistics (mean/stddev).
For InstanceNorm, we do not use learnable affine parameters. We do not track running statistics.</p>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-13">13</a></span>
<span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="k">def</span> <span class="nf">get_norm_layer</span><span class="p">(</span><span class="n">norm_type</span><span class="o">=</span><span class="s2">&quot;instance&quot;</span><span class="p">):</span>
<a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Return a normalization layer</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">        norm_type (str) -- the name of the normalization layer: batch | instance | none</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="sd">    For BatchNorm, we use learnable affine parameters and track running statistics (mean/stddev).</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    For InstanceNorm, we do not use learnable affine parameters. We do not track running statistics.</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="k">if</span> <span class="n">norm_type</span> <span class="o">==</span> <span class="s2">&quot;batch&quot;</span><span class="p">:</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>        <span class="n">norm_layer</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>            <span class="n">nn</span><span class="o">.</span><span class="n">BatchNorm2d</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>        <span class="p">)</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="k">elif</span> <span class="n">norm_type</span> <span class="o">==</span> <span class="s2">&quot;instance&quot;</span><span class="p">:</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>        <span class="n">norm_layer</span> <span class="o">=</span> <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>            <span class="n">nn</span><span class="o">.</span><span class="n">InstanceNorm2d</span><span class="p">,</span> <span class="n">affine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">track_running_stats</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>        <span class="p">)</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="k">elif</span> <span class="n">norm_type</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>        <span class="k">def</span> <span class="nf">norm_layer</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a>            <span class="k">return</span> <span class="n">Identity</span><span class="p">()</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;normalization layer [</span><span class="si">%s</span><span class="s2">] is not found&quot;</span> <span class="o">%</span> <span class="n">norm_type</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="k">return</span> <span class="n">norm_layer</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="prismtoolbox.nucleiseg.models.sop.architectures.init_net" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>          <code class="highlight language-python"><span class="n">init_net</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">init_type</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">init_gain</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">gpu_ids</span><span class="o">=</span><span class="p">[])</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Initialize a network: 1. register CPU/GPU device (with multi-GPU support); 2. initialize the network weights
Parameters:
    net (network)      -- the network to be initialized
    init_type (str)    -- the name of an initialization method: normal | xavier | kaiming | orthogonal
    gain (float)       -- scaling factor for normal, xavier and orthogonal.
    gpu_ids (int list) -- which GPUs the network runs on: e.g., 0,1,2
Return an initialized network.</p>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span>
<span class="normal"><a href="#__codelineno-0-88">88</a></span>
<span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="k">def</span> <span class="nf">init_net</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">init_type</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="n">init_gain</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">gpu_ids</span><span class="o">=</span><span class="p">[]):</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize a network: 1. register CPU/GPU device (with multi-GPU support); 2. initialize the network weights</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        net (network)      -- the network to be initialized</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        init_type (str)    -- the name of an initialization method: normal | xavier | kaiming | orthogonal</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        gain (float)       -- scaling factor for normal, xavier and orthogonal.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        gpu_ids (int list) -- which GPUs the network runs on: e.g., 0,1,2</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">    Return an initialized network.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gpu_ids</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="k">assert</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">net</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">gpu_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">net</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">DataParallel</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">gpu_ids</span><span class="p">)</span>  <span class="c1"># multi-GPUs</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="n">init_weights</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">init_type</span><span class="p">,</span> <span class="n">init_gain</span><span class="o">=</span><span class="n">init_gain</span><span class="p">)</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="k">return</span> <span class="n">net</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="prismtoolbox.nucleiseg.models.sop.architectures.init_weights" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>          <code class="highlight language-python"><span class="n">init_weights</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">init_type</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">init_gain</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Initialize network weights.
Parameters:
    net (network)   -- network to be initialized
    init_type (str) -- the name of an initialization method: normal | xavier | kaiming | orthogonal
    init_gain (float)    -- scaling factor for normal, xavier and orthogonal.
We use 'normal' in the original pix2pix and CycleGAN paper. But xavier and kaiming might
work better for some applications. Feel free to try yourself.</p>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/nucleiseg/models/sop/architectures.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="k">def</span> <span class="nf">init_weights</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="n">init_type</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span> <span class="n">init_gain</span><span class="o">=</span><span class="mf">0.02</span><span class="p">):</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize network weights.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        net (network)   -- network to be initialized</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        init_type (str) -- the name of an initialization method: normal | xavier | kaiming | orthogonal</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        init_gain (float)    -- scaling factor for normal, xavier and orthogonal.</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    We use &#39;normal&#39; in the original pix2pix and CycleGAN paper. But xavier and kaiming might</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">    work better for some applications. Feel free to try yourself.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="k">def</span> <span class="nf">init_func</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>  <span class="c1"># define the initialization function</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="n">classname</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="n">classname</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Conv&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">classname</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;Linear&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="p">):</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="k">if</span> <span class="n">init_type</span> <span class="o">==</span> <span class="s2">&quot;normal&quot;</span><span class="p">:</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>                <span class="n">init</span><span class="o">.</span><span class="n">normal_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">init_gain</span><span class="p">)</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="k">elif</span> <span class="n">init_type</span> <span class="o">==</span> <span class="s2">&quot;xavier&quot;</span><span class="p">:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>                <span class="n">init</span><span class="o">.</span><span class="n">xavier_normal_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="n">init_gain</span><span class="p">)</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="k">elif</span> <span class="n">init_type</span> <span class="o">==</span> <span class="s2">&quot;kaiming&quot;</span><span class="p">:</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>                <span class="n">init</span><span class="o">.</span><span class="n">kaiming_normal_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;fan_in&quot;</span><span class="p">)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>            <span class="k">elif</span> <span class="n">init_type</span> <span class="o">==</span> <span class="s2">&quot;orthogonal&quot;</span><span class="p">:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>                <span class="n">init</span><span class="o">.</span><span class="n">orthogonal_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">gain</span><span class="o">=</span><span class="n">init_gain</span><span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>                    <span class="s2">&quot;initialization method [</span><span class="si">%s</span><span class="s2">] is not implemented&quot;</span> <span class="o">%</span> <span class="n">init_type</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="p">)</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;bias&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span><span class="o">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>                <span class="n">init</span><span class="o">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="k">elif</span> <span class="p">(</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="n">classname</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;BatchNorm2d&quot;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>        <span class="p">):</span>  <span class="c1"># BatchNorm Layer&#39;s weight is not a matrix; only normal distribution applies.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>            <span class="n">init</span><span class="o">.</span><span class="n">normal_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">init_gain</span><span class="p">)</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>            <span class="n">init</span><span class="o">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">bias</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;initialize network with </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">init_type</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">net</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">init_func</span><span class="p">)</span>  <span class="c1"># apply the initialization function &lt;init_func&gt;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 - 2024 Loc Le Bescond
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../../..", "features": ["navigation.tabs", "navigation.indexes", "toc.integrate", "toc.follow"], "search": "../../../../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="../../../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
    
  </body>
</html>