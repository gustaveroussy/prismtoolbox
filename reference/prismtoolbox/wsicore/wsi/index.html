
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-8.5.10">
    
    
      
        <title>prismtoolbox.wsicore.wsi - PrismToolBox</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.2505c338.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#prismtoolbox.wsicore.wsi.WSI" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="PrismToolBox" class="md-header__button md-logo" aria-label="PrismToolBox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PrismToolBox
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              prismtoolbox.wsicore.wsi
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/gustaveroussy/PrismToolBox" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gustaveroussy/PrismToolBox
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../api_index/" class="md-tabs__link md-tabs__link--active">
        API
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../cli/preprocessing/" class="md-tabs__link">
        CLI
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../examples/index.md" class="md-tabs__link">
      Examples
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="PrismToolBox" class="md-nav__button md-logo" aria-label="PrismToolBox" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    PrismToolBox
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/gustaveroussy/PrismToolBox" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    gustaveroussy/PrismToolBox
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        
          
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2">
          API
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          API
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../api_index/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" checked>
      
      
      
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_2">
          prismtoolbox.wsicore
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="prismtoolbox.wsicore" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          prismtoolbox.wsicore
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          prismtoolbox.wsicore.wsi
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        prismtoolbox.wsicore.wsi
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;WSI
  </a>
  
    <nav class="md-nav" aria-label="<code class="doc-symbol doc-symbol-toc doc-symbol-class"></code>&nbsp;WSI">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.apply_pathologist_annotations" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;apply_pathologist_annotations
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.convert_micrometer_to_pixel" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_micrometer_to_pixel
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.convert_pixel_to_micrometer" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_pixel_to_micrometer
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.convert_units" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;convert_units
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.create_thumbnail" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;create_thumbnail
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.detect_tissue" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;detect_tissue
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.extract_patches" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;extract_patches
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.extract_patches_roi" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;extract_patches_roi
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.is_black_white" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;is_black_white
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.load_patches" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;load_patches
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.load_tissue_contours" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;load_tissue_contours
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.process_coord_candidate" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;process_coord_candidate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.read" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.read_region" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;read_region
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.retrieve_slide_name_ext" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;retrieve_slide_name_ext
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.save_patches" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;save_patches
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.save_tissue_contours" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;save_tissue_contours
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.scale_contours" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;scale_contours
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.set_roi" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;set_roi
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.set_slide_attributes" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;set_slide_attributes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.stitch" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;stitch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.visualize" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;visualize
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prismtoolbox.wsicore.wsi.WSI.worker_init" class="md-nav__link">
    <code class="doc-symbol doc-symbol-toc doc-symbol-method"></code>&nbsp;worker_init
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../core_utils/" class="md-nav__link">
        prismtoolbox.wsicore.core_utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
        
          
        
          
        
          
        
      
      
        <label class="md-nav__link" for="__nav_2_3">
          prismtoolbox.wsiemb
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="prismtoolbox.wsiemb" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          prismtoolbox.wsiemb
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../wsiemb/embedder/" class="md-nav__link">
        prismtoolbox.wsiemb.embedder
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../wsiemb/processing/" class="md-nav__link">
        prismtoolbox.wsiemb.processing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../wsiemb/emb_utils/" class="md-nav__link">
        prismtoolbox.wsiemb.emb_utils
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../nucleiseg/segmenter/" class="md-nav__link">
        prismtoolbox.nucleiseg
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
        
          
        
      
      
        <label class="md-nav__link" for="__nav_3">
          CLI
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CLI" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          CLI
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../cli/preprocessing/" class="md-nav__link">
        Preprocessing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../examples/index.md" class="md-nav__link">
        Examples
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/gustaveroussy/PrismToolBox/edit/master/docs/src/prismtoolbox/wsicore/wsi.py" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>prismtoolbox.wsicore.wsi</h1>

<div class="doc doc-object doc-module">




  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="prismtoolbox.wsicore.wsi.WSI" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-class"></code>            <code class="highlight language-python"><span class="n">WSI</span><span class="p">(</span><span class="n">slide_path</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;openslide&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">

  
      <p>The WSI (Whole Slide Image) class is responsible for handling operations
related to whole slide images.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>slide_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the slide image file.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>engine</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The engine used to read the slide image.</p>
            </div>
          </td>
          <td>
                <code>&#39;openslide&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Attributes:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.slide_path">slide_path</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the slide image file.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.engine">engine</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The engine used to read the slide image.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.slide_name">slide_name</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the slide image file.
Retrieved from the slide path using
<a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.retrieve_slide_name_ext">retrieve_slide_name_ext</a> method.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.slide_ext">slide_ext</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The extension of the slide image file.
Retrieved from the slide path using
<a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.retrieve_slide_name_ext">retrieve_slide_name_ext</a> method.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.slide">slide</span></code></td>
          <td>
                <code>OpenSlide | TiffSlide</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The wsi read from the file using engine.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.dimensions">dimensions</span></code></td>
          <td>
                <code>list[tuple[int, int]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dimensions of the slide image.
Set by the set_slide_attributes method.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.level_dimensions">level_dimensions</span></code></td>
          <td>
                <code>list[tuple[int, int]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dimensions of the different levels of the slide image.
Set by the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_slide_attributes">set_slide_attributes</a> method.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.level_downsamples">level_downsamples</span></code></td>
          <td>
                <code>list[tuple[int, int]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The downsampling factors of the different levels of
the slide image. Set by the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_slide_attributes">set_slide_attributes</a>
method.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.properties">properties</span></code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The properties of the slide image.
Set by the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_slide_attributes">set_slide_attributes</a> method.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.offset">offset</span></code></td>
          <td>
                <code>tuple[int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The offset of the slide image.
Set by the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_slide_attributes">set_slide_attributes</a> method.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.ROI">ROI</span></code></td>
          <td>
                <code>ndarray | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The region of interest in the slide image.
Please use the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_roi">set_roi</a> method to set the ROI.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.ROI_width">ROI_width</span></code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The width of the region of interest.
Set by the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_roi">set_roi</a> method.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.ROI_height">ROI_height</span></code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The height of the region of interest.
Set by the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_roi">set_roi</a> method.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.tissue_contours">tissue_contours</span></code></td>
          <td>
                <code>list[ndarray] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The contours of the tissue in the slide image.
Please use the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.detect_tissue">detect_tissue</a>
method to detect the tissue contours.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.coords">coords</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The coordinates of patches extracted from slide image.
Please use the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.extract_patches">extract_patches</a>
method to extract patches.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="prismtoolbox.wsicore.wsi.WSI.coords_attrs">coords_attrs</span></code></td>
          <td>
                <code>dict | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The attributes of the coordinates.
Set by the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.extract_patches">extract_patches</a> method.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

                <details class="quote">
                  <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
                  <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-51"> 51</a></span>
<span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">slide_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;openslide&quot;</span><span class="p">):</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The WSI (Whole Slide Image) class is responsible for handling operations</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">    related to whole slide images.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        slide_path: The path to the slide image file.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        engine: The engine used to read the slide image.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        slide_path (str): The path to the slide image file.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        engine (str): The engine used to read the slide image.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        slide_name (str): The name of the slide image file.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">            Retrieved from the slide path using</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">            [retrieve_slide_name_ext][prismtoolbox.wsicore.WSI.retrieve_slide_name_ext] method.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        slide_ext (str): The extension of the slide image file.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">            Retrieved from the slide path using</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">            [retrieve_slide_name_ext][prismtoolbox.wsicore.WSI.retrieve_slide_name_ext] method.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        slide (OpenSlide | TiffSlide): The wsi read from the file using engine.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        dimensions (list[tuple[int, int]]): The dimensions of the slide image.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">            Set by the set_slide_attributes method.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        level_dimensions (list[tuple[int, int]]): The dimensions of the different levels of the slide image.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">            Set by the [set_slide_attributes][prismtoolbox.wsicore.WSI.set_slide_attributes] method.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">        level_downsamples (list[tuple[int, int]]): The downsampling factors of the different levels of</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">            the slide image. Set by the [set_slide_attributes][prismtoolbox.wsicore.WSI.set_slide_attributes]</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            method.</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">        properties (dict): The properties of the slide image.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">            Set by the [set_slide_attributes][prismtoolbox.wsicore.WSI.set_slide_attributes] method.</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">        offset (tuple[int, int]): The offset of the slide image.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            Set by the [set_slide_attributes][prismtoolbox.wsicore.WSI.set_slide_attributes] method.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">        ROI (ndarray | None): The region of interest in the slide image.</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">            Please use the [set_roi][prismtoolbox.wsicore.WSI.set_roi] method to set the ROI.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        ROI_width (int | None): The width of the region of interest.</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            Set by the [set_roi][prismtoolbox.wsicore.WSI.set_roi] method.</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        ROI_height (int | None): The height of the region of interest.</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            Set by the [set_roi][prismtoolbox.wsicore.WSI.set_roi] method.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        tissue_contours (list[ndarray] | None): The contours of the tissue in the slide image.</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">            Please use the [detect_tissue][prismtoolbox.wsicore.WSI.detect_tissue]</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            method to detect the tissue contours.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        coords (np.ndarray | None): The coordinates of patches extracted from slide image.</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            Please use the [extract_patches][prismtoolbox.wsicore.WSI.extract_patches]</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            method to extract patches.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        coords_attrs (dict | None): The attributes of the coordinates.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            Set by the [extract_patches][prismtoolbox.wsicore.WSI.extract_patches] method.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">slide_path</span> <span class="o">=</span> <span class="n">slide_path</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">=</span> <span class="n">engine</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide_ext</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieve_slide_name_ext</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_path</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">slide</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">slide_path</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">set_slide_attributes</span><span class="p">()</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ROI_width</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ROI_height</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
                </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.apply_pathologist_annotations" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">apply_pathologist_annotations</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="s1">&#39;annotation&#39;</span><span class="p">,</span> <span class="n">column_to_select</span><span class="o">=</span><span class="s1">&#39;objectType&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Apply pathologist annotations to the tissue contours by intersecting the annotations
with the tissue contours. Requires the tissue contours to be set for the slide beforehand
with the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.detect_tissue">detect_tissue</a> method.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the .geojson file containing the annotations extracted from QuPath.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>class_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The class name to use for selecting the annotations to apply.</p>
            </div>
          </td>
          <td>
                <code>&#39;annotation&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>column_to_select</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The column to select in the GeoDataFrame.</p>
            </div>
          </td>
          <td>
                <code>&#39;objectType&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span>
<span class="normal"><a href="#__codelineno-0-666">666</a></span>
<span class="normal"><a href="#__codelineno-0-667">667</a></span>
<span class="normal"><a href="#__codelineno-0-668">668</a></span>
<span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="k">def</span> <span class="nf">apply_pathologist_annotations</span><span class="p">(</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>    <span class="n">class_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;annotation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>    <span class="n">column_to_select</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;objectType&quot;</span><span class="p">,</span>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Apply pathologist annotations to the tissue contours by intersecting the annotations</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">    with the tissue contours. Requires the tissue contours to be set for the slide beforehand</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a><span class="sd">    with the [detect_tissue][prismtoolbox.wsicore.WSI.detect_tissue] method.</span>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="sd">        path: The path to the .geojson file containing the annotations extracted from QuPath.</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="sd">        class_name: The class name to use for selecting the annotations to apply.</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="sd">        column_to_select: The column to select in the GeoDataFrame.</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>    <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>    <span class="p">),</span> <span class="s2">&quot;No tissue contours found for the slide, please run the detect_tissue method first&quot;</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>    <span class="n">offset</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>    <span class="n">pathologist_annotations</span> <span class="o">=</span> <span class="n">read_qupath_annotations</span><span class="p">(</span>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>        <span class="n">path</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">class_name</span><span class="o">=</span><span class="n">class_name</span><span class="p">,</span> <span class="n">column_to_select</span><span class="o">=</span><span class="n">column_to_select</span>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>    <span class="p">)</span>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>    <span class="n">polygons</span> <span class="o">=</span> <span class="n">contoursToPolygons</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span><span class="p">,</span> <span class="n">make_valid</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a>    <span class="n">intersection</span> <span class="o">=</span> <span class="n">intersectionPolygons</span><span class="p">(</span><span class="n">polygons</span><span class="p">,</span> <span class="n">pathologist_annotations</span><span class="p">)</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span> <span class="o">=</span> <span class="n">PolygonsToContours</span><span class="p">(</span><span class="n">intersection</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.convert_micrometer_to_pixel" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">convert_micrometer_to_pixel</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convert a value from micrometer to pixel.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>value</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The value to convert (in micrometer).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>level</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The level at which the conversion should be performed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>axis</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The axis to use for getting the conversion factor (x or y).</p>
            </div>
          </td>
          <td>
                <code>&#39;x&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input value in pixel.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="k">def</span> <span class="nf">convert_micrometer_to_pixel</span><span class="p">(</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>    <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>    <span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a value from micrometer to pixel.</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="sd">        value: The value to convert (in micrometer).</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a><span class="sd">        level: The level at which the conversion should be performed.</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="sd">        axis: The axis to use for getting the conversion factor (x or y).</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        The input value in pixel.</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="si">}</span><span class="s2">.mpp-</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]))</span> <span class="o">//</span> <span class="nb">int</span><span class="p">(</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.convert_pixel_to_micrometer" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">convert_pixel_to_micrometer</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convert a value from pixel to micrometer.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>value</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The value to convert (in pixel).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>level</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The level at which the conversion should be performed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>axis</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The axis to use for getting the conversion factor (x or y).</p>
            </div>
          </td>
          <td>
                <code>&#39;x&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input value in micrometer.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-258" name="__codelineno-0-258"></a><span class="k">def</span> <span class="nf">convert_pixel_to_micrometer</span><span class="p">(</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>    <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a value from pixel to micrometer.</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">        value: The value to convert (in pixel).</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        level: The level at which the conversion should be performed.</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        axis: The axis to use for getting the conversion factor (x or y).</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">        The input value in micrometer.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>    <span class="k">return</span> <span class="p">(</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="n">value</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="o">*</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="si">}</span><span class="s2">.mpp-</span><span class="si">{</span><span class="n">axis</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">level</span><span class="p">]</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.convert_units" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">convert_units</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">from_unit</span><span class="p">,</span> <span class="n">to_unit</span><span class="o">=</span><span class="s1">&#39;px&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Convert a value from one unit to another.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>value</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The value to convert.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>level</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The level at which the conversion should be performed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>from_unit</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The unit to convert from (px or micro).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>to_unit</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The unit to convert to (px or micro).</p>
            </div>
          </td>
          <td>
                <code>&#39;px&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>axis</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The axis to use for getting the conversion factor (x or y).</p>
            </div>
          </td>
          <td>
                <code>&#39;x&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>int | float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input value converted in the desired unit.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="k">def</span> <span class="nf">convert_units</span><span class="p">(</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>    <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="n">from_unit</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="n">to_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;px&quot;</span><span class="p">,</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>    <span class="n">axis</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;x&quot;</span><span class="p">,</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a value from one unit to another.</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a><span class="sd">        value: The value to convert.</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="sd">        level: The level at which the conversion should be performed.</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="sd">        from_unit: The unit to convert from (px or micro).</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="sd">        to_unit: The unit to convert to (px or micro).</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        axis: The axis to use for getting the conversion factor (x or y).</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">        The input value converted in the desired unit.</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="k">if</span> <span class="n">from_unit</span> <span class="o">==</span> <span class="s2">&quot;micro&quot;</span> <span class="ow">and</span> <span class="n">to_unit</span> <span class="o">==</span> <span class="s2">&quot;px&quot;</span><span class="p">:</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_micrometer_to_pixel</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>    <span class="k">elif</span> <span class="n">from_unit</span> <span class="o">==</span> <span class="s2">&quot;px&quot;</span> <span class="ow">and</span> <span class="n">to_unit</span> <span class="o">==</span> <span class="s2">&quot;micro&quot;</span><span class="p">:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_pixel_to_micrometer</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="k">elif</span> <span class="n">from_unit</span> <span class="o">==</span> <span class="n">to_unit</span><span class="p">:</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="k">pass</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Conversion from </span><span class="si">{</span><span class="n">from_unit</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_unit</span><span class="si">}</span><span class="s2"> not supported.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>    <span class="k">return</span> <span class="n">value</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.create_thumbnail" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">create_thumbnail</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="n">crop_roi</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Create a thumbnail of the slide at a given level.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>level</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The level at which the thumbnail should be created.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>crop_roi</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A boolean to crop the thumbnail to the region of interest defined for the slide
(requires a ROI to be set for the slide beforehand with the
<a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_roi">set_roi</a> method)</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="PIL.Image.Image">Image</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A thumbnail of the slide as a PIL image.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span>
<span class="normal"><a href="#__codelineno-0-518">518</a></span>
<span class="normal"><a href="#__codelineno-0-519">519</a></span>
<span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-512" name="__codelineno-0-512"></a><span class="k">def</span> <span class="nf">create_thumbnail</span><span class="p">(</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>    <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>    <span class="n">crop_roi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a thumbnail of the slide at a given level.</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="sd">        level: The level at which the thumbnail should be created.</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="sd">        crop_roi: A boolean to crop the thumbnail to the region of interest defined for the slide</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">            (requires a ROI to be set for the slide beforehand with the</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">            [set_roi][prismtoolbox.wsicore.WSI.set_roi] method)</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">        A thumbnail of the slide as a PIL image.</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a>    <span class="n">thumb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_region</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">level</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_dimensions</span><span class="p">[</span><span class="n">level</span><span class="p">])</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a>        <span class="s2">&quot;RGB&quot;</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a>    <span class="p">)</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a>    <span class="k">if</span> <span class="n">crop_roi</span><span class="p">:</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>                <span class="s2">&quot;ROI is not set for the slide, please set the ROI with the set_roi method.&quot;</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>            <span class="p">)</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Creating thumbnail with ROI </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="n">coords_roi</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">level</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="n">thumb</span> <span class="o">=</span> <span class="n">thumb</span><span class="o">.</span><span class="n">crop</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">coords_roi</span><span class="p">))</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="k">return</span> <span class="n">thumb</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.detect_tissue" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">detect_tissue</span><span class="p">(</span><span class="n">seg_level</span><span class="p">,</span> <span class="n">window_avg</span><span class="p">,</span> <span class="n">window_eng</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">inside_roi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">inv_thresh</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">area_min</span><span class="o">=</span><span class="mf">200000.0</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Segment the tissue on the slide based on a threshold on the Law's texture
energy spot map and floodfill algorithm to fill the holes in the mask. The
tissue contours are stored in the tissue_contours attribute.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>seg_level</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The level at which the segmentation should be performed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>window_avg</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size of the window for local averaging.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>window_eng</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size of the window for Law's texture energy computation.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>thresh</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The threshold for binarization on the Law's texture energy spot map.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>inside_roi</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to identify the tissue only within a ROI (requires a ROI to be set for the slide
beforehand with the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_roi">set_roi</a> method).</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>inv_thresh</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to invert the thresholding.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>area_min</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The minimum area for a contour to be kept.</p>
            </div>
          </td>
          <td>
                <code>200000.0</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>start</code></td>
          <td>
                <code>tuple[int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The starting point for the floodfill algorithm (should be left at (0, 0) in most cases).</p>
            </div>
          </td>
          <td>
                <code>(0, 0)</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="k">def</span> <span class="nf">detect_tissue</span><span class="p">(</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a>    <span class="n">seg_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a>    <span class="n">window_avg</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a>    <span class="n">window_eng</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a>    <span class="n">thresh</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a>    <span class="n">inside_roi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a>    <span class="n">inv_thresh</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a>    <span class="n">area_min</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">2e5</span><span class="p">,</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a>    <span class="n">start</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Segment the tissue on the slide based on a threshold on the Law&#39;s texture</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">    energy spot map and floodfill algorithm to fill the holes in the mask. The</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">    tissue contours are stored in the tissue_contours attribute.</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">        seg_level: The level at which the segmentation should be performed.</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="sd">        window_avg: The size of the window for local averaging.</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="sd">        window_eng: The size of the window for Law&#39;s texture energy computation.</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="sd">        thresh: The threshold for binarization on the Law&#39;s texture energy spot map.</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a><span class="sd">        inside_roi: Set to True to identify the tissue only within a ROI (requires a ROI to be set for the slide</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">            beforehand with the [set_roi][prismtoolbox.wsicore.WSI.set_roi] method).</span>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="sd">        inv_thresh: Set to True to invert the thresholding.</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">        area_min: The minimum area for a contour to be kept.</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a><span class="sd">        start: The starting point for the floodfill algorithm (should be left at (0, 0) in most cases).</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>    <span class="n">final_contours</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>    <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_thumbnail</span><span class="p">(</span><span class="n">seg_level</span><span class="p">,</span> <span class="n">inside_roi</span><span class="p">))</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="n">img_avg</span> <span class="o">=</span> <span class="n">local_average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">window_avg</span><span class="p">)</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>    <span class="n">law_feats</span> <span class="o">=</span> <span class="n">compute_law_feats</span><span class="p">(</span><span class="n">img_avg</span><span class="p">,</span> <span class="n">window_eng</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>    <span class="n">filterred_img</span> <span class="o">=</span> <span class="n">apply_bilateral_filter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">law_feats</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">))</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="n">threshed_img</span> <span class="o">=</span> <span class="n">apply_binary_thresh</span><span class="p">(</span><span class="n">filterred_img</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">inv_thresh</span><span class="p">)</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="n">flooded_img</span> <span class="o">=</span> <span class="n">floodfill_img</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">threshed_img</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">start</span><span class="p">)</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="n">contours</span> <span class="o">=</span> <span class="n">contour_mask</span><span class="p">(</span><span class="n">flooded_img</span><span class="p">)</span>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a>    <span class="k">for</span> <span class="n">contour</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">:</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a>        <span class="n">c</span> <span class="o">=</span> <span class="n">contour</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>        <span class="n">area</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">contourArea</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="k">if</span> <span class="n">area</span> <span class="o">&gt;</span> <span class="n">area_min</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a>            <span class="n">final_contours</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">contour</span><span class="p">)</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">final_contours</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>            <span class="sa">f</span><span class="s2">&quot;No tissue contours found for the slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>        <span class="p">)</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>        <span class="n">scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">seg_level</span><span class="p">]</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>        <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>        <span class="n">final_contours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_contours</span><span class="p">(</span><span class="n">final_contours</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a>        <span class="n">final_contours</span> <span class="o">=</span> <span class="p">[</span><span class="n">cont</span> <span class="o">+</span> <span class="n">offset</span> <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="n">final_contours</span><span class="p">]</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a>        <span class="c1"># Sanity check to ensure that the contours are all within a ROI is provided</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>            <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>                <span class="p">[</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>                    <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">cont</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">cont</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="p">[</span><span class="mi">2</span><span class="p">:])</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>                    <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="n">final_contours</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>                <span class="p">]</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>            <span class="p">)</span>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span> <span class="o">=</span> <span class="n">final_contours</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>            <span class="sa">f</span><span class="s2">&quot;Identified </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">final_contours</span><span class="p">)</span><span class="si">}</span><span class="s2"> contours for the slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>        <span class="p">)</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.extract_patches" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">extract_patches</span><span class="p">(</span><span class="n">patch_size</span><span class="p">,</span> <span class="n">patch_level</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overlap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;px&#39;</span><span class="p">,</span> <span class="s1">&#39;px&#39;</span><span class="p">),</span> <span class="n">use_padding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">contours_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rgb_threshs</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">220</span><span class="p">),</span> <span class="n">percentages</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extract valid patches from the slide with different extraction modes. A patch
is considered valid if it is not black or white and is within the region of
interest or the tissue contours if relevant. The extracted patches are stored as
coordinates in the coords attribute, and the attributes of the coordinates are
stored in the coords_attrs attribute.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>patch_size</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size of the patches to extract (assumed to be square).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>patch_level</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The level at which the patches should be extracted.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>mode</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The mode to use for the extraction:</p>
<ul>
<li>"contours" mode extracts patches within the tissue contours (requires the tissue contours
to be set for the slide beforehand with the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.detect_tissue">detect_tissue</a>
method).</li>
<li>"roi" mode extracts patches within the region of interest (requires the ROI to be set
for the slide beforehand with the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_roi">set_roi</a> method).</li>
<li>"all" mode extracts patches from the entire slide</li>
</ul>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>step_size</code></td>
          <td>
                <code>float | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The step size for the sliding window (if set to None, the step size will be computed based on the
overlap).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>overlap</code></td>
          <td>
                <code>float | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The overlap between patches as an absolute value (must be provided if step_size is set to None).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>units</code></td>
          <td>
                <code>tuple[str, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The units for the patch size and step size/overlap values (pixels: px, micrometers: micro).</p>
            </div>
          </td>
          <td>
                <code>(&#39;px&#39;, &#39;px&#39;)</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>use_padding</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to use padding for the extraction.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>contours_mode</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The mode to use for the contour checking function (must be provided if mode is
set to contours). See <a class="autorefs autorefs-internal" href="../core_utils/#prismtoolbox.wsicore.core_utils.IsInContour">IsInContour</a> for
more details.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>rgb_threshs</code></td>
          <td>
                <code>tuple[int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The tuple of thresholds for the RGB channels (black threshold, white threshold).</p>
            </div>
          </td>
          <td>
                <code>(2, 220)</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>percentages</code></td>
          <td>
                <code>tuple[float, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The tuple of percentages of pixels below/above the thresholds to consider the patch as
black/white.</p>
            </div>
          </td>
          <td>
                <code>(0.6, 0.9)</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span>
<span class="normal"><a href="#__codelineno-0-675">675</a></span>
<span class="normal"><a href="#__codelineno-0-676">676</a></span>
<span class="normal"><a href="#__codelineno-0-677">677</a></span>
<span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span>
<span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span>
<span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="k">def</span> <span class="nf">extract_patches</span><span class="p">(</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>    <span class="n">patch_size</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>    <span class="n">patch_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>    <span class="n">step_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="n">overlap</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a>    <span class="n">units</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;px&quot;</span><span class="p">,</span> <span class="s2">&quot;px&quot;</span><span class="p">),</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>    <span class="n">use_padding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a>    <span class="n">contours_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a>    <span class="n">rgb_threshs</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">220</span><span class="p">),</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a>    <span class="n">percentages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract valid patches from the slide with different extraction modes. A patch</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">    is considered valid if it is not black or white and is within the region of</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">    interest or the tissue contours if relevant. The extracted patches are stored as</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">    coordinates in the coords attribute, and the attributes of the coordinates are</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">    stored in the coords_attrs attribute.</span>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">        patch_size: The size of the patches to extract (assumed to be square).</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">        patch_level: The level at which the patches should be extracted.</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a><span class="sd">        mode: The mode to use for the extraction:</span>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="sd">            - &quot;contours&quot; mode extracts patches within the tissue contours (requires the tissue contours</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a><span class="sd">            to be set for the slide beforehand with the [detect_tissue][prismtoolbox.wsicore.WSI.detect_tissue]</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a><span class="sd">            method).</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="sd">            - &quot;roi&quot; mode extracts patches within the region of interest (requires the ROI to be set</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a><span class="sd">            for the slide beforehand with the [set_roi][prismtoolbox.wsicore.WSI.set_roi] method).</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">            - &quot;all&quot; mode extracts patches from the entire slide</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a><span class="sd">        step_size: The step size for the sliding window (if set to None, the step size will be computed based on the</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="sd">            overlap).</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a><span class="sd">        overlap: The overlap between patches as an absolute value (must be provided if step_size is set to None).</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a><span class="sd">        units: The units for the patch size and step size/overlap values (pixels: px, micrometers: micro).</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a><span class="sd">        use_padding: Set to True to use padding for the extraction.</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a><span class="sd">        contours_mode: The mode to use for the contour checking function (must be provided if mode is</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a><span class="sd">            set to contours). See [IsInContour][prismtoolbox.wsicore.core_utils.IsInContour] for</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a><span class="sd">            more details.</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a><span class="sd">        rgb_threshs: The tuple of thresholds for the RGB channels (black threshold, white threshold).</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a><span class="sd">        percentages: The tuple of percentages of pixels below/above the thresholds to consider the patch as</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="sd">            black/white.</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="p">[</span><span class="n">unit</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;micro&quot;</span><span class="p">,</span> <span class="s2">&quot;px&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">unit</span> <span class="ow">in</span> <span class="n">units</span><span class="p">]</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>    <span class="p">),</span> <span class="s2">&quot;Units must be either &#39;micro&#39; or &#39;px&#39;&quot;</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>    <span class="n">patch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">(</span><span class="n">patch_size</span><span class="p">,</span> <span class="n">patch_level</span><span class="p">,</span> <span class="n">units</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>    <span class="k">if</span> <span class="n">step_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>        <span class="k">if</span> <span class="n">overlap</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                <span class="s2">&quot;Either step_size or overlap must be provided if step_size is not set&quot;</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>            <span class="p">)</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>        <span class="n">step_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">patch_size</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">(</span><span class="n">overlap</span><span class="p">,</span> <span class="n">patch_level</span><span class="p">,</span> <span class="n">units</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>        <span class="n">step_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">convert_units</span><span class="p">(</span><span class="n">step_size</span><span class="p">,</span> <span class="n">patch_level</span><span class="p">,</span> <span class="n">units</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>        <span class="sa">f</span><span class="s2">&quot;Extracting patches of size </span><span class="si">{</span><span class="n">patch_size</span><span class="si">}</span><span class="s2"> at level </span><span class="si">{</span><span class="n">patch_level</span><span class="si">}</span><span class="s2"> with step size </span><span class="si">{</span><span class="n">step_size</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>    <span class="p">)</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;contours&quot;</span><span class="p">:</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting patches with &#39;contours&#39; mode.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Empty tissue contours vector for the slide, please run the detect_tissue method first.&quot;</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;No tissue contours found for the slide.&quot;</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>        <span class="k">assert</span> <span class="n">contours_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Contours mode must be provided if mode is set to &#39;contours&#39;.&quot;</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>        <span class="n">valid_coords</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>        <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span><span class="p">:</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>            <span class="n">roi_dim</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">boundingRect</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span> <span class="c1"># type: ignore</span>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing ROI of dimensions: </span><span class="si">{</span><span class="n">roi_dim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>            <span class="n">valid_coords</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">extract_patches_roi</span><span class="p">(</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>                    <span class="n">patch_level</span><span class="p">,</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>                    <span class="n">patch_size</span><span class="p">,</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>                    <span class="n">step_size</span><span class="p">,</span>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>                    <span class="n">roi_dim</span><span class="p">,</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a>                    <span class="n">use_padding</span><span class="p">,</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a>                    <span class="n">cont</span><span class="p">,</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a>                    <span class="n">contours_mode</span><span class="p">,</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>                    <span class="n">rgb_threshs</span><span class="o">=</span><span class="n">rgb_threshs</span><span class="p">,</span>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a>                    <span class="n">percentages</span><span class="o">=</span><span class="n">percentages</span><span class="p">,</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a>                <span class="p">)</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>            <span class="p">)</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>        <span class="n">valid_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">valid_coords</span><span class="p">)</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a>    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;roi&quot;</span><span class="p">:</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Extracting patches with &#39;roi&#39; mode.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI_width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI_height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>                <span class="s2">&quot;ROI is not set for the slide, please set the ROI with the set_roi method.&quot;</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>            <span class="p">)</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="n">roi_dim</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI_width</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI_height</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing ROI of dimensions: </span><span class="si">{</span><span class="n">roi_dim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>        <span class="n">valid_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_patches_roi</span><span class="p">(</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>            <span class="n">patch_level</span><span class="p">,</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>            <span class="n">patch_size</span><span class="p">,</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>            <span class="n">step_size</span><span class="p">,</span>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>            <span class="n">roi_dim</span><span class="p">,</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>            <span class="n">use_padding</span><span class="p">,</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>            <span class="n">rgb_threshs</span><span class="o">=</span><span class="n">rgb_threshs</span><span class="p">,</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>            <span class="n">percentages</span><span class="o">=</span><span class="n">percentages</span><span class="p">,</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>        <span class="p">)</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>        <span class="n">roi_dim</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing ROI of dimensions: </span><span class="si">{</span><span class="n">roi_dim</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>        <span class="n">valid_coords</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_patches_roi</span><span class="p">(</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>            <span class="n">patch_level</span><span class="p">,</span>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a>            <span class="n">patch_size</span><span class="p">,</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a>            <span class="n">step_size</span><span class="p">,</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a>            <span class="n">roi_dim</span><span class="p">,</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>            <span class="n">use_padding</span><span class="p">,</span>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>            <span class="n">rgb_threshs</span><span class="o">=</span><span class="n">rgb_threshs</span><span class="p">,</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>            <span class="n">percentages</span><span class="o">=</span><span class="n">percentages</span><span class="p">,</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="p">)</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s2"> not supported&quot;</span><span class="p">)</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>    <span class="n">attr</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>        <span class="s2">&quot;patch_size&quot;</span><span class="p">:</span> <span class="n">patch_size</span><span class="p">,</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>        <span class="s2">&quot;patch_level&quot;</span><span class="p">:</span> <span class="n">patch_level</span><span class="p">,</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="s2">&quot;downsample&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">patch_level</span><span class="p">],</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="s2">&quot;downsampled_level_dim&quot;</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level_dimensions</span><span class="p">[</span><span class="n">patch_level</span><span class="p">])),</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="s2">&quot;level_dim&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_dimensions</span><span class="p">[</span><span class="n">patch_level</span><span class="p">],</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="p">,</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>    <span class="p">}</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_coords</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="sa">f</span><span class="s2">&quot;No valid coordinates found for the slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="p">)</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>            <span class="sa">f</span><span class="s2">&quot;Identified a total of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_coords</span><span class="p">)</span><span class="si">}</span><span class="s2"> valid coordinates for the slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>        <span class="p">)</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="o">=</span> <span class="n">valid_coords</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span> <span class="o">=</span> <span class="n">attr</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.extract_patches_roi" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">extract_patches_roi</span><span class="p">(</span><span class="n">patch_level</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">roi_dim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_padding</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">contour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">contours_mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">coord_candidates</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rgb_threshs</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">220</span><span class="p">),</span> <span class="n">percentages</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span> <span class="n">return_indices</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Extract valid patches from a region of interest, i.e if the patch is not
black or white and is within the region of interest/contours if relevant).</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>patch_level</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The level at which the patches should be extracted.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>patch_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size of the patches to extract (assumed to be square).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>step_size</code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The step size to use for the sliding window.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>roi_dim</code></td>
          <td>
                <code>tuple[int, int, int, int] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The top-left corner coordinates and dimensions of the region of interest. Must be provided if
coord_candidates is set to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>use_padding</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to use padding for the extraction.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>contour</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The tissue contour to use for the extraction. If set to None, will not check if patches are within
a contour.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>contours_mode</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The mode for the contour checking function.
See <a class="autorefs autorefs-internal" href="../core_utils/#prismtoolbox.wsicore.core_utils.IsInContour">IsInContour</a> for more details. Must be provided
if mode is set to contours. Otherwise, will not check if patches are within the contours.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>coord_candidates</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Precomputed candidate coordinates for the patches. If set to None, will compute the
candidate coordinates based on the ROI dimensions and the step size.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>rgb_threshs</code></td>
          <td>
                <code>tuple[int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The tuple of thresholds for the RGB channels (black threshold, white threshold).</p>
            </div>
          </td>
          <td>
                <code>(2, 220)</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>percentages</code></td>
          <td>
                <code>tuple[float, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The tuple of percentages of pixels below/above the thresholds to consider the patch as
black/white.</p>
            </div>
          </td>
          <td>
                <code>(0.6, 0.9)</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>return_indices</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to return the indices of the valid coordinates.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="numpy.ndarray">ndarray</span> | tuple[<span title="numpy.ndarray">ndarray</span>, list[int]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An array of valid coordinates for the patches (i.e. coordinates of the top-left corner of the patches).</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-809">809</a></span>
<span class="normal"><a href="#__codelineno-0-810">810</a></span>
<span class="normal"><a href="#__codelineno-0-811">811</a></span>
<span class="normal"><a href="#__codelineno-0-812">812</a></span>
<span class="normal"><a href="#__codelineno-0-813">813</a></span>
<span class="normal"><a href="#__codelineno-0-814">814</a></span>
<span class="normal"><a href="#__codelineno-0-815">815</a></span>
<span class="normal"><a href="#__codelineno-0-816">816</a></span>
<span class="normal"><a href="#__codelineno-0-817">817</a></span>
<span class="normal"><a href="#__codelineno-0-818">818</a></span>
<span class="normal"><a href="#__codelineno-0-819">819</a></span>
<span class="normal"><a href="#__codelineno-0-820">820</a></span>
<span class="normal"><a href="#__codelineno-0-821">821</a></span>
<span class="normal"><a href="#__codelineno-0-822">822</a></span>
<span class="normal"><a href="#__codelineno-0-823">823</a></span>
<span class="normal"><a href="#__codelineno-0-824">824</a></span>
<span class="normal"><a href="#__codelineno-0-825">825</a></span>
<span class="normal"><a href="#__codelineno-0-826">826</a></span>
<span class="normal"><a href="#__codelineno-0-827">827</a></span>
<span class="normal"><a href="#__codelineno-0-828">828</a></span>
<span class="normal"><a href="#__codelineno-0-829">829</a></span>
<span class="normal"><a href="#__codelineno-0-830">830</a></span>
<span class="normal"><a href="#__codelineno-0-831">831</a></span>
<span class="normal"><a href="#__codelineno-0-832">832</a></span>
<span class="normal"><a href="#__codelineno-0-833">833</a></span>
<span class="normal"><a href="#__codelineno-0-834">834</a></span>
<span class="normal"><a href="#__codelineno-0-835">835</a></span>
<span class="normal"><a href="#__codelineno-0-836">836</a></span>
<span class="normal"><a href="#__codelineno-0-837">837</a></span>
<span class="normal"><a href="#__codelineno-0-838">838</a></span>
<span class="normal"><a href="#__codelineno-0-839">839</a></span>
<span class="normal"><a href="#__codelineno-0-840">840</a></span>
<span class="normal"><a href="#__codelineno-0-841">841</a></span>
<span class="normal"><a href="#__codelineno-0-842">842</a></span>
<span class="normal"><a href="#__codelineno-0-843">843</a></span>
<span class="normal"><a href="#__codelineno-0-844">844</a></span>
<span class="normal"><a href="#__codelineno-0-845">845</a></span>
<span class="normal"><a href="#__codelineno-0-846">846</a></span>
<span class="normal"><a href="#__codelineno-0-847">847</a></span>
<span class="normal"><a href="#__codelineno-0-848">848</a></span>
<span class="normal"><a href="#__codelineno-0-849">849</a></span>
<span class="normal"><a href="#__codelineno-0-850">850</a></span>
<span class="normal"><a href="#__codelineno-0-851">851</a></span>
<span class="normal"><a href="#__codelineno-0-852">852</a></span>
<span class="normal"><a href="#__codelineno-0-853">853</a></span>
<span class="normal"><a href="#__codelineno-0-854">854</a></span>
<span class="normal"><a href="#__codelineno-0-855">855</a></span>
<span class="normal"><a href="#__codelineno-0-856">856</a></span>
<span class="normal"><a href="#__codelineno-0-857">857</a></span>
<span class="normal"><a href="#__codelineno-0-858">858</a></span>
<span class="normal"><a href="#__codelineno-0-859">859</a></span>
<span class="normal"><a href="#__codelineno-0-860">860</a></span>
<span class="normal"><a href="#__codelineno-0-861">861</a></span>
<span class="normal"><a href="#__codelineno-0-862">862</a></span>
<span class="normal"><a href="#__codelineno-0-863">863</a></span>
<span class="normal"><a href="#__codelineno-0-864">864</a></span>
<span class="normal"><a href="#__codelineno-0-865">865</a></span>
<span class="normal"><a href="#__codelineno-0-866">866</a></span>
<span class="normal"><a href="#__codelineno-0-867">867</a></span>
<span class="normal"><a href="#__codelineno-0-868">868</a></span>
<span class="normal"><a href="#__codelineno-0-869">869</a></span>
<span class="normal"><a href="#__codelineno-0-870">870</a></span>
<span class="normal"><a href="#__codelineno-0-871">871</a></span>
<span class="normal"><a href="#__codelineno-0-872">872</a></span>
<span class="normal"><a href="#__codelineno-0-873">873</a></span>
<span class="normal"><a href="#__codelineno-0-874">874</a></span>
<span class="normal"><a href="#__codelineno-0-875">875</a></span>
<span class="normal"><a href="#__codelineno-0-876">876</a></span>
<span class="normal"><a href="#__codelineno-0-877">877</a></span>
<span class="normal"><a href="#__codelineno-0-878">878</a></span>
<span class="normal"><a href="#__codelineno-0-879">879</a></span>
<span class="normal"><a href="#__codelineno-0-880">880</a></span>
<span class="normal"><a href="#__codelineno-0-881">881</a></span>
<span class="normal"><a href="#__codelineno-0-882">882</a></span>
<span class="normal"><a href="#__codelineno-0-883">883</a></span>
<span class="normal"><a href="#__codelineno-0-884">884</a></span>
<span class="normal"><a href="#__codelineno-0-885">885</a></span>
<span class="normal"><a href="#__codelineno-0-886">886</a></span>
<span class="normal"><a href="#__codelineno-0-887">887</a></span>
<span class="normal"><a href="#__codelineno-0-888">888</a></span>
<span class="normal"><a href="#__codelineno-0-889">889</a></span>
<span class="normal"><a href="#__codelineno-0-890">890</a></span>
<span class="normal"><a href="#__codelineno-0-891">891</a></span>
<span class="normal"><a href="#__codelineno-0-892">892</a></span>
<span class="normal"><a href="#__codelineno-0-893">893</a></span>
<span class="normal"><a href="#__codelineno-0-894">894</a></span>
<span class="normal"><a href="#__codelineno-0-895">895</a></span>
<span class="normal"><a href="#__codelineno-0-896">896</a></span>
<span class="normal"><a href="#__codelineno-0-897">897</a></span>
<span class="normal"><a href="#__codelineno-0-898">898</a></span>
<span class="normal"><a href="#__codelineno-0-899">899</a></span>
<span class="normal"><a href="#__codelineno-0-900">900</a></span>
<span class="normal"><a href="#__codelineno-0-901">901</a></span>
<span class="normal"><a href="#__codelineno-0-902">902</a></span>
<span class="normal"><a href="#__codelineno-0-903">903</a></span>
<span class="normal"><a href="#__codelineno-0-904">904</a></span>
<span class="normal"><a href="#__codelineno-0-905">905</a></span>
<span class="normal"><a href="#__codelineno-0-906">906</a></span>
<span class="normal"><a href="#__codelineno-0-907">907</a></span>
<span class="normal"><a href="#__codelineno-0-908">908</a></span>
<span class="normal"><a href="#__codelineno-0-909">909</a></span>
<span class="normal"><a href="#__codelineno-0-910">910</a></span>
<span class="normal"><a href="#__codelineno-0-911">911</a></span>
<span class="normal"><a href="#__codelineno-0-912">912</a></span>
<span class="normal"><a href="#__codelineno-0-913">913</a></span>
<span class="normal"><a href="#__codelineno-0-914">914</a></span>
<span class="normal"><a href="#__codelineno-0-915">915</a></span>
<span class="normal"><a href="#__codelineno-0-916">916</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-809" name="__codelineno-0-809"></a><span class="k">def</span> <span class="nf">extract_patches_roi</span><span class="p">(</span>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>    <span class="n">patch_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>    <span class="n">patch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>    <span class="n">step_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a>    <span class="n">roi_dim</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a>    <span class="n">use_padding</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a>    <span class="n">contour</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>    <span class="n">contours_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a>    <span class="n">coord_candidates</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a>    <span class="n">rgb_threshs</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">220</span><span class="p">),</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a>    <span class="n">percentages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a>    <span class="n">return_indices</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Extract valid patches from a region of interest, i.e if the patch is not</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a><span class="sd">    black or white and is within the region of interest/contours if relevant).</span>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a><span class="sd">        patch_level: The level at which the patches should be extracted.</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a><span class="sd">        patch_size: The size of the patches to extract (assumed to be square).</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a><span class="sd">        step_size: The step size to use for the sliding window.</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a><span class="sd">        roi_dim: The top-left corner coordinates and dimensions of the region of interest. Must be provided if</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a><span class="sd">            coord_candidates is set to None.</span>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a><span class="sd">        use_padding: Set to True to use padding for the extraction.</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="sd">        contour: The tissue contour to use for the extraction. If set to None, will not check if patches are within</span>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a><span class="sd">            a contour.</span>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a><span class="sd">        contours_mode: The mode for the contour checking function.</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">            See [IsInContour][prismtoolbox.wsicore.core_utils.IsInContour] for more details. Must be provided</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a><span class="sd">            if mode is set to contours. Otherwise, will not check if patches are within the contours.</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a><span class="sd">        coord_candidates: Precomputed candidate coordinates for the patches. If set to None, will compute the</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a><span class="sd">            candidate coordinates based on the ROI dimensions and the step size.</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a><span class="sd">        rgb_threshs: The tuple of thresholds for the RGB channels (black threshold, white threshold).</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a><span class="sd">        percentages: The tuple of percentages of pixels below/above the thresholds to consider the patch as</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a><span class="sd">            black/white.</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a><span class="sd">        return_indices: Set to True to return the indices of the valid coordinates.</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a><span class="sd">        An array of valid coordinates for the patches (i.e. coordinates of the top-left corner of the patches).</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>    <span class="n">patch_downsample</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">patch_level</span><span class="p">])</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>    <span class="n">ref_patch_size</span> <span class="o">=</span> <span class="n">patch_size</span> <span class="o">*</span> <span class="n">patch_downsample</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>    <span class="k">if</span> <span class="n">coord_candidates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>        <span class="k">if</span> <span class="n">roi_dim</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">step_size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a>                <span class="s2">&quot;roi_dim and step_size must be provided if coord_candidates is not set.&quot;</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a>            <span class="p">)</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a>        <span class="n">start_x</span><span class="p">,</span> <span class="n">start_y</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">roi_dim</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a>        <span class="n">img_w</span><span class="p">,</span> <span class="n">img_h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_dimensions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a>        <span class="k">if</span> <span class="n">use_padding</span><span class="p">:</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a>            <span class="n">stop_y</span> <span class="o">=</span> <span class="n">start_y</span> <span class="o">+</span> <span class="n">h</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a>            <span class="n">stop_x</span> <span class="o">=</span> <span class="n">start_x</span> <span class="o">+</span> <span class="n">w</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="n">stop_y</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_y</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">img_h</span> <span class="o">-</span> <span class="n">ref_patch_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>            <span class="n">stop_x</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start_x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">img_w</span> <span class="o">-</span> <span class="n">ref_patch_size</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a>        <span class="n">step_size</span> <span class="o">=</span> <span class="n">step_size</span> <span class="o">*</span> <span class="n">patch_downsample</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>        <span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start_x</span><span class="p">,</span> <span class="n">stop_x</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step_size</span><span class="p">)</span>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>        <span class="n">y_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start_y</span><span class="p">,</span> <span class="n">stop_y</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="n">step_size</span><span class="p">)</span>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>        <span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>        <span class="n">coord_candidates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>            <span class="p">[</span><span class="n">x_coords</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">y_coords</span><span class="o">.</span><span class="n">flatten</span><span class="p">()]</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>        <span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>    <span class="k">if</span> <span class="n">contour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>        <span class="k">if</span> <span class="n">contours_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>                <span class="s2">&quot;A contour mode must be provided if patch extraction mode is set to contours.&quot;</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>            <span class="p">)</span> 
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>        <span class="n">cont_check_fn</span> <span class="o">=</span> <span class="n">IsInContour</span><span class="p">(</span>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>            <span class="n">contour</span><span class="p">,</span> <span class="n">patch_size</span><span class="o">=</span><span class="n">ref_patch_size</span><span class="p">,</span> <span class="n">center_shift</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">contours_mode</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>        <span class="p">)</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a>            <span class="sa">f</span><span class="s2">&quot;Extracting patches with contour checking function mode </span><span class="si">{</span><span class="n">contours_mode</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>        <span class="p">)</span>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a>        <span class="n">cont_check_fn</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>    <span class="n">num_workers</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">cpu_count</span><span class="p">()</span>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a>    <span class="n">pool</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Pool</span><span class="p">(</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a>        <span class="n">num_workers</span><span class="p">,</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a>        <span class="n">initializer</span><span class="o">=</span><span class="n">WSI</span><span class="o">.</span><span class="n">worker_init</span><span class="p">,</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>        <span class="n">initargs</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">slide_path</span><span class="p">,</span>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">,</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>        <span class="p">),</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>    <span class="p">)</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>    <span class="n">iterable</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>        <span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">cont_check_fn</span><span class="p">,</span> <span class="n">patch_level</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">rgb_threshs</span><span class="p">,</span> <span class="n">percentages</span><span class="p">)</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coord_candidates</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>    <span class="p">]</span>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>    <span class="n">valid_coords</span> <span class="o">=</span> <span class="n">pool</span><span class="o">.</span><span class="n">starmap</span><span class="p">(</span><span class="n">WSI</span><span class="o">.</span><span class="n">process_coord_candidate</span><span class="p">,</span> <span class="n">iterable</span><span class="p">)</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>    <span class="n">pool</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>    <span class="n">valid_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coord</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">valid_coords</span><span class="p">)</span> <span class="k">if</span> <span class="n">coord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">]</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>    <span class="n">valid_coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">coord_candidates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">valid_indices</span><span class="p">])</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>        <span class="sa">f</span><span class="s2">&quot;Identified </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_coords</span><span class="p">)</span><span class="si">}</span><span class="s2">  valid coordinates in the ROI </span><span class="si">{</span><span class="n">roi_dim</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>    <span class="p">)</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>    <span class="k">if</span> <span class="n">return_indices</span><span class="p">:</span>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>        <span class="k">return</span> <span class="n">valid_coords</span><span class="p">,</span> <span class="n">valid_indices</span>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>        <span class="k">return</span> <span class="n">valid_coords</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.is_black_white" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">is_black_white</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="n">rgb_threshs</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">220</span><span class="p">),</span> <span class="n">percentages</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Check if a patch is black or white.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>patch</code></td>
          <td>
                <code><span title="PIL.Image.Image">Image</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input patch.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>rgb_threshs</code></td>
          <td>
                <code>tuple[int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The tuple of thresholds for the RGB channels (black threshold, white threshold).</p>
            </div>
          </td>
          <td>
                <code>(2, 220)</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>percentages</code></td>
          <td>
                <code>tuple[float, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The tuple of percentages of pixels below/above the thresholds to consider the patch
as black/white.</p>
            </div>
          </td>
          <td>
                <code>(0.6, 0.9)</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>True if the patch is black or white, False otherwise.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="k">def</span> <span class="nf">is_black_white</span><span class="p">(</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="n">patch</span><span class="p">:</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="n">rgb_threshs</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">220</span><span class="p">),</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="n">percentages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if a patch is black or white.</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        patch: The input patch.</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        rgb_threshs: The tuple of thresholds for the RGB channels (black threshold, white threshold).</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        percentages: The tuple of percentages of pixels below/above the thresholds to consider the patch</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">            as black/white.</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        True if the patch is black or white, False otherwise.</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">return</span> <span class="n">isBlackPatch</span><span class="p">(</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">patch</span><span class="p">,</span> <span class="n">rgb_thresh</span><span class="o">=</span><span class="n">rgb_threshs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">percentage</span><span class="o">=</span><span class="n">percentages</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="p">)</span> <span class="ow">or</span> <span class="n">isWhitePatch</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="n">rgb_thresh</span><span class="o">=</span><span class="n">rgb_threshs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">percentage</span><span class="o">=</span><span class="n">percentages</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.load_patches" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">load_patches</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load the patches from a hdf5 file.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>file_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the hdf5 file containing the patches.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-462" name="__codelineno-0-462"></a><span class="k">def</span> <span class="nf">load_patches</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the patches from a hdf5 file.</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a><span class="sd">        file_path: The path to the hdf5 file containing the patches.</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading patches for slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span> <span class="o">=</span> <span class="n">read_h5_file</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;coords&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.load_tissue_contours" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">load_tissue_contours</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Load the tissue contours from a pickle file.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>file_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the pickle file containing the tissue contours.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="k">def</span> <span class="nf">load_tissue_contours</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load the tissue contours from a pickle file.</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">        file_path: The path to the pickle file containing the tissue contours.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading tissue contours for slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span> <span class="o">=</span> <span class="n">load_obj_with_pickle</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.process_coord_candidate" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">process_coord_candidate</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">cont_check_fn</span><span class="p">,</span> <span class="n">patch_level</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">,</span> <span class="n">rgb_threshs</span><span class="o">=</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">220</span><span class="p">),</span> <span class="n">percentages</span><span class="o">=</span><span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">))</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Determine if a candidate coordinate is valid based on a contour checking
function and/or black/white thresholding.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>coord</code></td>
          <td>
                <code>tuple[int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The candidate coordinate.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>cont_check_fn</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="prismtoolbox.wsicore.core_utils.IsInContour" href="../core_utils/#prismtoolbox.wsicore.core_utils.IsInContour">IsInContour</a> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The contour checking function.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>patch_level</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The level at which the patch should be extracted.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>patch_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size of the patch (assumed to be square).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>rgb_threshs</code></td>
          <td>
                <code>tuple[int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The tuple of thresholds for the RGB channels (black threshold, white threshold).</p>
            </div>
          </td>
          <td>
                <code>(2, 220)</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>percentages</code></td>
          <td>
                <code>tuple[float, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The tuple of percentages of pixels below/above the thresholds to consider the patch as
black/white.</p>
            </div>
          </td>
          <td>
                <code>(0.6, 0.9)</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>tuple[int, int] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The coordinate if it is valid, None otherwise.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="k">def</span> <span class="nf">process_coord_candidate</span><span class="p">(</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>    <span class="n">coord</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="n">cont_check_fn</span><span class="p">:</span> <span class="n">IsInContour</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>    <span class="n">patch_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="n">patch_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>    <span class="n">rgb_threshs</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">220</span><span class="p">),</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="n">percentages</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">),</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine if a candidate coordinate is valid based on a contour checking</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a><span class="sd">    function and/or black/white thresholding.</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="sd">        coord: The candidate coordinate.</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        cont_check_fn: The contour checking function.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a><span class="sd">        patch_level: The level at which the patch should be extracted.</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        patch_size: The size of the patch (assumed to be square).</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        rgb_threshs: The tuple of thresholds for the RGB channels (black threshold, white threshold).</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">        percentages: The tuple of percentages of pixels below/above the thresholds to consider the patch as</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">            black/white.</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">        The coordinate if it is valid, None otherwise.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="k">if</span> <span class="n">cont_check_fn</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cont_check_fn</span><span class="p">(</span><span class="n">coord</span><span class="p">):</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="n">patch</span> <span class="o">=</span> <span class="n">wsi</span><span class="o">.</span><span class="n">read_region</span><span class="p">(</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="n">coord</span><span class="p">,</span> <span class="n">patch_level</span><span class="p">,</span> <span class="p">(</span><span class="n">patch_size</span><span class="p">,</span> <span class="n">patch_size</span><span class="p">)</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">WSI</span><span class="o">.</span><span class="n">is_black_white</span><span class="p">(</span><span class="n">patch</span><span class="p">,</span> <span class="n">rgb_threshs</span><span class="p">,</span> <span class="n">percentages</span><span class="p">):</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="k">return</span> <span class="n">coord</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>            <span class="k">return</span> <span class="kc">None</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.read" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">read</span><span class="p">(</span><span class="n">slide_path</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Read a slide with a given engine.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>slide_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the slide.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>engine</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The backend library to use for reading the slide
(currently only openslide and tiffslide are supported).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A slide object.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">slide_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read a slide with a given engine.</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        slide_path: The path to the slide.</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        engine: The backend library to use for reading the slide</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">            (currently only openslide and tiffslide are supported).</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        A slide object.</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="k">if</span> <span class="n">engine</span> <span class="o">==</span> <span class="s2">&quot;openslide&quot;</span><span class="p">:</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="kn">import</span> <span class="nn">openslide</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">slide</span> <span class="o">=</span> <span class="n">openslide</span><span class="o">.</span><span class="n">OpenSlide</span><span class="p">(</span><span class="n">slide_path</span><span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">elif</span> <span class="n">engine</span> <span class="o">==</span> <span class="s2">&quot;tiffslide&quot;</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="kn">import</span> <span class="nn">tiffslide</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="n">slide</span> <span class="o">=</span> <span class="n">tiffslide</span><span class="o">.</span><span class="n">TiffSlide</span><span class="p">(</span><span class="n">slide_path</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;engine </span><span class="si">{</span><span class="n">engine</span><span class="si">}</span><span class="s2"> not supported&quot;</span><span class="p">)</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="k">return</span> <span class="n">slide</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.read_region" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">read_region</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Read a region from the slide for a given level and size.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>location</code></td>
          <td>
                <code>tuple[int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The coordinates of the top left corner of the region (in pixels).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>level</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The level at which the region should be read.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>size</code></td>
          <td>
                <code>tuple[int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The size of the region (in pixels).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="PIL.Image.Image">Image</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The desired region of the slide as a PIL image.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="k">def</span> <span class="nf">read_region</span><span class="p">(</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">location</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="n">level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="n">size</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Read a region from the slide for a given level and size.</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a><span class="sd">        location: The coordinates of the top left corner of the region (in pixels).</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a><span class="sd">        level: The level at which the region should be read.</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a><span class="sd">        size: The size of the region (in pixels).</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a><span class="sd">        The desired region of the slide as a PIL image.</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">read_region</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">level</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.retrieve_slide_name_ext" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">retrieve_slide_name_ext</span><span class="p">(</span><span class="n">slide_path</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Retrieves slide name and slide extension from slide path.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>slide_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the slide.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>tuple[str, str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple (slide name, slide ext).</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="k">def</span> <span class="nf">retrieve_slide_name_ext</span><span class="p">(</span><span class="n">slide_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieves slide name and slide extension from slide path.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        slide_path: The path to the slide.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        A tuple (slide name, slide ext).</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">slide_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;([^/]+?)(?=\.[\w\.]+$)&quot;</span><span class="p">,</span> <span class="n">slide_path</span><span class="p">)</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="n">slide_ext</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=\.)[\w\.]+$&quot;</span><span class="p">,</span> <span class="n">slide_path</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="k">if</span> <span class="n">slide_ext</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">slide_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>            <span class="sa">f</span><span class="s2">&quot;Could not retrieve slide name and extension from </span><span class="si">{</span><span class="n">slide_path</span><span class="si">}</span><span class="s2">. &quot;</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>            <span class="s2">&quot;Please check the file path.&quot;</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="n">slide_name</span><span class="p">,</span> <span class="n">slide_ext</span> <span class="o">=</span> <span class="n">slide_name</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">slide_ext</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="k">return</span> <span class="n">slide_name</span><span class="p">,</span> <span class="n">slide_ext</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.save_patches" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">save_patches</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;h5&#39;</span><span class="p">,</span> <span class="n">selected_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">append_to_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Save the patches in a hdf5 or geojson file.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>save_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the directory where the patches will be saved.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>file_format</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The format for the saving (h5 for python processing, geojson for QuPath processing).</p>
            </div>
          </td>
          <td>
                <code>&#39;h5&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>selected_idx</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An array of indices of the patches to save (if set to None, all the patches will be saved).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>merge</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to merge the patches into a single polygon (for geojson format only).</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>label</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An optional label to assign to the patches (for geojson format only).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>color</code></td>
          <td>
                <code>tuple[int, int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An optional color to assign to the patches (for geojson format only).</p>
            </div>
          </td>
          <td>
                <code>(255, 0, 0)</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>append_to_existing_file</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to append the patches to an existing geojson file.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="k">def</span> <span class="nf">save_patches</span><span class="p">(</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="n">file_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;h5&quot;</span><span class="p">,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="n">selected_idx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="n">append_to_existing_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Save the patches in a hdf5 or geojson file.</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        save_dir: The path to the directory where the patches will be saved.</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        file_format: The format for the saving (h5 for python processing, geojson for QuPath processing).</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        selected_idx: An array of indices of the patches to save (if set to None, all the patches will be saved).</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        merge: Set to True to merge the patches into a single polygon (for geojson format only).</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">        label: An optional label to assign to the patches (for geojson format only).</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a><span class="sd">        color: An optional color to assign to the patches (for geojson format only).</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">        append_to_existing_file: Set to True to append the patches to an existing geojson file.</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="s2">&quot;No patches found. Please check if patches were correctly extracted.&quot;</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="p">)</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="s2">&quot;No attributes set for the patches. &quot;</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>            <span class="s2">&quot;Please check if patches were correctly extracted.&quot;</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="p">)</span>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="k">if</span> <span class="n">selected_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">selected_idx</span><span class="p">])</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> does not exist, creating new folder...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;h5&quot;</span><span class="p">:</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="n">asset_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="n">coords</span><span class="p">}</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="n">attr_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;coords&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span><span class="p">}</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2">.h5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>            <span class="sa">f</span><span class="s2">&quot;Saving patches for slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> as h5 file.&quot;</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>        <span class="p">)</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>        <span class="n">save_patches_with_hdf5</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">asset_dict</span><span class="p">,</span> <span class="n">attr_dict</span><span class="p">)</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;geojson&quot;</span><span class="p">:</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2">.geojson&quot;</span><span class="p">)</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="n">patch_downsample</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span><span class="p">[</span><span class="s2">&quot;patch_level&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="p">)</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="n">polygons</span> <span class="o">=</span> <span class="n">patchesToPolygons</span><span class="p">(</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>            <span class="n">coords</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span><span class="p">[</span><span class="s2">&quot;patch_size&quot;</span><span class="p">],</span> <span class="n">patch_downsample</span><span class="p">,</span> <span class="n">merge</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="p">)</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="sa">f</span><span class="s2">&quot;Saving </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span><span class="si">}</span><span class="s2"> patches for slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> as geojson file.&quot;</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="p">)</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">export_polygons_to_qupath</span><span class="p">(</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>            <span class="n">polygons</span><span class="p">,</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>            <span class="n">file_path</span><span class="p">,</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="s2">&quot;annotation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="n">offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>            <span class="n">append_to_existing_file</span><span class="o">=</span><span class="n">append_to_existing_file</span><span class="p">,</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="p">)</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;jpg&quot;</span> <span class="ow">or</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;png&quot;</span><span class="p">:</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> does not exist, creating new folder...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>            <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>            <span class="sa">f</span><span class="s2">&quot;Saving </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span><span class="si">}</span><span class="s2"> patches for slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> with </span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="p">)</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="n">patch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_region</span><span class="p">(</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>                <span class="n">coord</span><span class="p">,</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span><span class="p">[</span><span class="s2">&quot;patch_level&quot;</span><span class="p">],</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span><span class="p">[</span><span class="s2">&quot;patch_size&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span><span class="p">[</span><span class="s2">&quot;patch_size&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>            <span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="n">patch</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Format </span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2"> not supported.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.save_tissue_contours" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">save_tissue_contours</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="n">selected_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">file_format</span><span class="o">=</span><span class="s1">&#39;pickle&#39;</span><span class="p">,</span> <span class="n">merge</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">append_to_existing_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">make_valid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Save the tissue contours in a pickle or geojson file.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>save_dir</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the directory where the contours will be saved.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>selected_idx</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An array of indices of the contours to save
(if set to None, all the contours will be saved).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>file_format</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The file format for saving the contours
(pickle for python processing, geojson for QuPath processing).</p>
            </div>
          </td>
          <td>
                <code>&#39;pickle&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>merge</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to merge the contours into a single polygon (for geojson format only).</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>label</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An optional label to assign to the tissue contours (for geojson format only).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>color</code></td>
          <td>
                <code>tuple[int, int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An optional color to assign to the tissue contours (for geojson format only).</p>
            </div>
          </td>
          <td>
                <code>(255, 0, 0)</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>append_to_existing_file</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to append the contours to an existing geojson file.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>make_valid</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to make the polygons valid (for geojson format only).</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="k">def</span> <span class="nf">save_tissue_contours</span><span class="p">(</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>    <span class="n">save_dir</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>    <span class="n">selected_idx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="n">file_format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;pickle&quot;</span><span class="p">,</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="n">merge</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="n">label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="n">color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="n">append_to_existing_file</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="n">make_valid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Save the tissue contours in a pickle or geojson file.</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">        save_dir: The path to the directory where the contours will be saved.</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        selected_idx: An array of indices of the contours to save</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">            (if set to None, all the contours will be saved).</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">        file_format: The file format for saving the contours</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">            (pickle for python processing, geojson for QuPath processing).</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="sd">        merge: Set to True to merge the contours into a single polygon (for geojson format only).</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        label: An optional label to assign to the tissue contours (for geojson format only).</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">        color: An optional color to assign to the tissue contours (for geojson format only).</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        append_to_existing_file: Set to True to append the contours to an existing geojson file.</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">        make_valid: Set to True to make the polygons valid (for geojson format only).</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="s2">&quot;No tissue contours found for the slide, &quot;</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="s2">&quot;please run the detect_tissue method first&quot;</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>    <span class="p">)</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="k">if</span> <span class="n">selected_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="n">tissue_contours</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">selected_idx</span><span class="p">]</span>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="n">tissue_contours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">save_dir</span><span class="p">):</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Folder </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2"> does not exist, creating new folder...&quot;</span><span class="p">)</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">save_dir</span><span class="p">)</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="k">if</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;pickle&quot;</span><span class="p">:</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="sa">f</span><span class="s2">&quot;Saving tissue contours for slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> as pickle file.&quot;</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="p">)</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="n">save_obj_with_pickle</span><span class="p">(</span><span class="n">tissue_contours</span><span class="p">,</span> <span class="n">file_path</span><span class="p">)</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>    <span class="k">elif</span> <span class="n">file_format</span> <span class="o">==</span> <span class="s2">&quot;geojson&quot;</span><span class="p">:</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">save_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2">.geojson&quot;</span><span class="p">)</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="sa">f</span><span class="s2">&quot;Saving </span><span class="si">{</span><span class="n">selected_idx</span><span class="si">}</span><span class="s2"> tissue contours for slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2"> at </span><span class="si">{</span><span class="n">file_path</span><span class="si">}</span><span class="s2"> as geojson file.&quot;</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="p">)</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="n">polygons</span> <span class="o">=</span> <span class="n">contoursToPolygons</span><span class="p">(</span><span class="n">tissue_contours</span><span class="p">,</span> <span class="n">merge</span><span class="p">,</span> <span class="n">make_valid</span><span class="p">)</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a>        <span class="n">export_polygons_to_qupath</span><span class="p">(</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>            <span class="n">polygons</span><span class="p">,</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a>            <span class="n">file_path</span><span class="p">,</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>            <span class="s2">&quot;annotation&quot;</span><span class="p">,</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>            <span class="n">offset</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offset</span><span class="p">,</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>            <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">append_to_existing_file</span><span class="o">=</span><span class="n">append_to_existing_file</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>        <span class="p">)</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;format </span><span class="si">{</span><span class="n">file_format</span><span class="si">}</span><span class="s2"> not supported&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.scale_contours" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">scale_contours</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Scale the contours by a given factor.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>contours</code></td>
          <td>
                <code>list[<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The contours to scale.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>scale</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The scale factor to apply.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>list[<span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input list with scaled contours.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="k">def</span> <span class="nf">scale_contours</span><span class="p">(</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="n">contours</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Scale the contours by a given factor.</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        contours: The contours to scale.</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">        scale: The scale factor to apply.</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">         The input list with scaled contours.</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="n">scaled_contours</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cont</span> <span class="o">*</span> <span class="n">scale</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="n">contours</span><span class="p">]</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="k">return</span> <span class="n">scaled_contours</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.set_roi" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">set_roi</span><span class="p">(</span><span class="n">roi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rois_df_path</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Set the region of interest for the slide. Can be set manually or by selecting
a region on a thumbnail. The ROI is stored as a tuple in the ROI attribute.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>roi</code></td>
          <td>
                <code>tuple[int, int, int, int] | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set the region of interest manually as a tuple (x1, y1, x2, y2).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>rois_df_path</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to dataframe containing the ROIs with a slide_id column identifying the slide, and 
the ROI coordinates as columns (x1, y1, x2, y2). If roi is not provided, the ROI will be set from this dataframe.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns:
    The region of interest set for the slide as a tuple (x1, y1, x2, y2).</p>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-541">541</a></span>
<span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span>
<span class="normal"><a href="#__codelineno-0-566">566</a></span>
<span class="normal"><a href="#__codelineno-0-567">567</a></span>
<span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-541" name="__codelineno-0-541"></a><span class="k">def</span> <span class="nf">set_roi</span><span class="p">(</span>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a>    <span class="n">roi</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a>    <span class="n">rois_df_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the region of interest for the slide. Can be set manually or by selecting</span>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    a region on a thumbnail. The ROI is stored as a tuple in the ROI attribute.</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">        roi: Set the region of interest manually as a tuple (x1, y1, x2, y2).</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a><span class="sd">        rois_df_path: The path to dataframe containing the ROIs with a slide_id column identifying the slide, and </span>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a><span class="sd">            the ROI coordinates as columns (x1, y1, x2, y2). If roi is not provided, the ROI will be set from this dataframe.</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a><span class="sd">        The region of interest set for the slide as a tuple (x1, y1, x2, y2).</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>    <span class="k">if</span> <span class="n">roi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="n">ROI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>    <span class="k">elif</span> <span class="n">rois_df_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="n">rois_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">rois_df_path</span><span class="p">)</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="k">if</span> <span class="s2">&quot;slide_id&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">rois_df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">rois_df</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>                <span class="s2">&quot;The provided dataframe does not contain a &#39;slide_id&#39; column, or does not have enough columns for ROI coordinates.&quot;</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="n">ROI</span> <span class="o">=</span> <span class="n">rois_df</span><span class="p">[</span><span class="n">rois_df</span><span class="o">.</span><span class="n">slide_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No ROI provided, prompting user to select one.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="n">level</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>            <span class="sa">f</span><span class="s2">&quot;No ROI was provided, please select a level at which the ROI should be created (max level: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level_dimensions</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2">): &quot;</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="p">)</span>
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">level</span><span class="p">:</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No level provided, setting the ROI at the highest level.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>            <span class="n">level</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>            <span class="n">level</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_thumbnail</span><span class="p">(</span><span class="n">level</span><span class="p">))</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="n">ROI</span> <span class="o">=</span> <span class="n">select_roi_on_thumbnail</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">level</span><span class="p">]))</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="n">ROI</span> <span class="o">=</span> <span class="p">(</span><span class="n">ROI</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">level</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span> <span class="o">=</span> <span class="n">ROI</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ROI_width</span> <span class="o">=</span> <span class="n">ROI</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">ROI</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ROI_height</span> <span class="o">=</span> <span class="n">ROI</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="n">ROI</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ROI for slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2"> has been set to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-582" name="__codelineno-0-582"></a>    <span class="k">return</span> <span class="n">ROI</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.set_slide_attributes" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">set_slide_attributes</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Set the slide attributes.</p>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-471" name="__codelineno-0-471"></a><span class="k">def</span> <span class="nf">set_slide_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Set the slide attributes.&quot;&quot;&quot;</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">==</span> <span class="s2">&quot;openslide&quot;</span><span class="p">:</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">dimensions</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">level_dimensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">level_dimensions</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">level_downsamples</span>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">properties</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine</span> <span class="o">==</span> <span class="s2">&quot;tiffslide&quot;</span><span class="p">:</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">dimensions</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">level_dimensions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">level_dimensions</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">level_downsamples</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">properties</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">properties</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Engine </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="si">}</span><span class="s2"> not supported.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="k">if</span> <span class="p">(</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="si">}</span><span class="s2">.bounds-x&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="si">}</span><span class="s2">.bounds-x&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="p">):</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="si">}</span><span class="s2">.bounds-x&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="o">-</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">properties</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="si">}</span><span class="s2">.bounds-y&quot;</span><span class="p">]),</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.stitch" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">stitch</span><span class="p">(</span><span class="n">vis_level</span><span class="p">,</span> <span class="n">selected_idx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">black_white</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">draw_grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">crop_roi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">background_color</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Stitch the patches extracted on an image. The patches can be masked and
colored depending on the mask and colors provided. Requires the coordinates of
the patches to be set for the slide beforehand with the
<a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.extract_patches">extract_patches</a> method.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>vis_level</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The level at which the patches should be visualized.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>selected_idx</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An array of indices of the patches to visualize (if set to None, all the patches will be
visualized).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>colors</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An array of RGB colors to apply to the patches (if set to None, the patches will be visualized as
they are).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>alpha</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set the transparency of the colors to apply to the patches.</p>
            </div>
          </td>
          <td>
                <code>0.6</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>black_white</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to visualize a binary mask of the patches extracted.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>draw_grid</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to draw a grid on the stitched patches.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>crop_roi</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to crop the visualization to the region of interest (requires a ROI to be set for the
slide beforehand with the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_roi">set_roi</a> method).</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>background_color</code></td>
          <td>
                <code>tuple[int, int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The color of the background.</p>
            </div>
          </td>
          <td>
                <code>(0, 0, 0)</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="PIL.Image.Image">Image</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A PIL image of the stitched patches.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1019" name="__codelineno-0-1019"></a><span class="k">def</span> <span class="nf">stitch</span><span class="p">(</span>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>    <span class="n">vis_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>    <span class="n">selected_idx</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>    <span class="n">colors</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span><span class="p">,</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>    <span class="n">black_white</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>    <span class="n">draw_grid</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>    <span class="n">crop_roi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>    <span class="n">background_color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Stitch the patches extracted on an image. The patches can be masked and</span>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="sd">    colored depending on the mask and colors provided. Requires the coordinates of</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><span class="sd">    the patches to be set for the slide beforehand with the</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="sd">    [extract_patches][prismtoolbox.wsicore.WSI.extract_patches] method.</span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">        vis_level: The level at which the patches should be visualized.</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="sd">        selected_idx: An array of indices of the patches to visualize (if set to None, all the patches will be</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">            visualized).</span>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="sd">        colors: An array of RGB colors to apply to the patches (if set to None, the patches will be visualized as</span>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><span class="sd">            they are).</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">        alpha: Set the transparency of the colors to apply to the patches.</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">        black_white: Set to True to visualize a binary mask of the patches extracted.</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">        draw_grid: Set to True to draw a grid on the stitched patches.</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="sd">        crop_roi: Set to True to crop the visualization to the region of interest (requires a ROI to be set for the</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a><span class="sd">            slide beforehand with the [set_roi][prismtoolbox.wsicore.WSI.set_roi] method).</span>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a><span class="sd">        background_color: The color of the background.</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="sd">        A PIL image of the stitched patches.</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a>            <span class="sa">f</span><span class="s2">&quot;No attributes set for the patches of the slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2">, please check if patches were correctly extracted.&quot;</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a>        <span class="p">)</span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a>    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="p">(</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>        <span class="s2">&quot;No coordinates provided for the patches to visualize, please run the &quot;</span>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>        <span class="s2">&quot;extract_patches method first or load the coordinates from a file.&quot;</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>    <span class="p">)</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>    <span class="k">if</span> <span class="n">crop_roi</span><span class="p">:</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI_width</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI_height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>                <span class="s2">&quot;ROI is not set for the slide, please set the ROI with the set_roi method.&quot;</span>
<a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>            <span class="p">)</span>
<a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI_width</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">vis_level</span><span class="p">])),</span> <span class="nb">int</span><span class="p">(</span>
<a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>            <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI_height</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">vis_level</span><span class="p">])</span>
<a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>        <span class="p">)</span>
<a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>        <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="p">[:</span><span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>        <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_dimensions</span><span class="p">[</span><span class="n">vis_level</span><span class="p">]</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>        <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>    <span class="n">patch_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span><span class="p">[</span><span class="s2">&quot;patch_size&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>    <span class="n">patch_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords_attrs</span><span class="p">[</span><span class="s2">&quot;patch_level&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>    <span class="n">patch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">patch_size</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">patch_level</span><span class="p">])</span>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>    <span class="n">canvas</span> <span class="o">=</span> <span class="n">init_image</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">black_white</span><span class="p">,</span> <span class="n">color_bakground</span><span class="o">=</span><span class="n">background_color</span><span class="p">)</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>    <span class="n">downsample_vis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">vis_level</span><span class="p">]</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>    <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">))</span>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a>    <span class="k">if</span> <span class="n">selected_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>        <span class="n">idxs</span> <span class="o">=</span> <span class="n">idxs</span><span class="p">[</span><span class="n">selected_idx</span><span class="p">]</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>    <span class="n">patch_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">patch_size</span> <span class="o">/</span> <span class="n">downsample_vis</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a>    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a>        <span class="sa">f</span><span class="s2">&quot;Stitching </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">idxs</span><span class="p">)</span><span class="si">}</span><span class="s2"> patches at level </span><span class="si">{</span><span class="n">vis_level</span><span class="si">}</span><span class="s2"> with patch size </span><span class="si">{</span><span class="n">patch_size</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a>        <span class="sa">f</span><span class="s2">&quot;with colors </span><span class="si">{</span><span class="n">colors</span><span class="w"> </span><span class="ow">is</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="kc">None</span><span class="si">}</span><span class="s2">.&quot;</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a>    <span class="p">)</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a>    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">idxs</span><span class="p">:</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a>        <span class="n">coord</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coords</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>        <span class="n">coord_downsampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">coord</span> <span class="o">-</span> <span class="n">offset</span><span class="p">)</span> <span class="o">/</span> <span class="n">downsample_vis</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>            <span class="nb">int</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>        <span class="p">)</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>        <span class="n">patch_size_coord</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>            <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">coord_downsampled</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">patch_size</span><span class="p">),</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>            <span class="nb">min</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">coord_downsampled</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">),</span> <span class="n">patch_size</span><span class="p">),</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>        <span class="p">)</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">patch_size_coord</span><span class="p">):</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>            <span class="k">continue</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>        <span class="k">if</span> <span class="n">black_white</span><span class="p">:</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>            <span class="n">patch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">patch_size_coord</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>            <span class="n">colors</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>            <span class="n">patch</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
<a id="__codelineno-0-1100" name="__codelineno-0-1100"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">slide</span><span class="o">.</span><span class="n">read_region</span><span class="p">(</span>
<a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>                    <span class="nb">tuple</span><span class="p">(</span><span class="n">coord</span><span class="p">),</span> <span class="n">vis_level</span><span class="p">,</span> <span class="n">patch_size_coord</span>
<a id="__codelineno-0-1102" name="__codelineno-0-1102"></a>                <span class="p">)</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;RGB&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>            <span class="p">)</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a>        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">idxs</span><span class="p">),</span> <span class="p">(</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>                <span class="s2">&quot;The number of colors provided must match &quot;</span>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a>                <span class="s2">&quot;the number of selected coordinates.&quot;</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a>            <span class="p">)</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a>            <span class="n">color</span> <span class="o">=</span> <span class="n">colors</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a>            <span class="n">color_patch</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a>                <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">patch_size_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">patch_size_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">color</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>            <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>            <span class="n">canvas</span><span class="p">[</span>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a>                <span class="n">coord_downsampled</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">coord_downsampled</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">patch_size_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a>                <span class="n">coord_downsampled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">coord_downsampled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">patch_size_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a>                <span class="p">:,</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span><span class="n">color_patch</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">patch</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">patch</span><span class="p">)</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>            <span class="n">canvas</span><span class="p">[</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>                <span class="n">coord_downsampled</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="n">coord_downsampled</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">patch_size_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>                <span class="n">coord_downsampled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">:</span> <span class="n">coord_downsampled</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">patch_size_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>                <span class="p">:,</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>            <span class="p">]</span> <span class="o">=</span> <span class="n">patch</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>        <span class="k">if</span> <span class="n">draw_grid</span><span class="p">:</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>            <span class="n">cv2</span><span class="o">.</span><span class="n">rectangle</span><span class="p">(</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>                <span class="n">canvas</span><span class="p">,</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>                <span class="nb">tuple</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">coord_downsampled</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>                <span class="nb">tuple</span><span class="p">(</span><span class="n">coord_downsampled</span> <span class="o">+</span> <span class="n">patch_size_coord</span><span class="p">),</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>                <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>                <span class="n">thickness</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>            <span class="p">)</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">canvas</span><span class="p">)</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.visualize" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">visualize</span><span class="p">(</span><span class="n">vis_level</span><span class="p">,</span> <span class="n">crop_roi</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">contours_color</span><span class="o">=</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">line_thickness</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">number_contours</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">black_white</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">view_slide_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Visualize the slide with or without the contours of the tissue.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>vis_level</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The level at which the visualization should be performed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>crop_roi</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to crop the visualization to the region of interest (requires a ROI to be set for the
slide beforehand with the <a class="autorefs autorefs-internal" href="#prismtoolbox.wsicore.wsi.WSI.set_roi">set_roi</a> method).</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>contours_color</code></td>
          <td>
                <code>tuple[int, int, int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The color to use for the contours.</p>
            </div>
          </td>
          <td>
                <code>(255, 0, 0)</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>line_thickness</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The thickness to use for the contours</p>
            </div>
          </td>
          <td>
                <code>500</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>max_size</code></td>
          <td>
                <code>int | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The maximum size for the visualization for the width or height of the image.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>number_contours</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to number the contours.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>black_white</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to visualize a binary mask of the contoured tissue.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>view_slide_only</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Set to True to visualize the slide only (without the contours).</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="PIL.Image.Image">Image</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A PIL image of the visualization.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-918" name="__codelineno-0-918"></a><span class="k">def</span> <span class="nf">visualize</span><span class="p">(</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a>    <span class="n">vis_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>    <span class="n">crop_roi</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a>    <span class="n">contours_color</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a>    <span class="n">line_thickness</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">,</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>    <span class="n">max_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a>    <span class="n">number_contours</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a>    <span class="n">black_white</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a>    <span class="n">view_slide_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Image</span><span class="o">.</span><span class="n">Image</span><span class="p">:</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Visualize the slide with or without the contours of the tissue.</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">        vis_level: The level at which the visualization should be performed.</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a><span class="sd">        crop_roi: Set to True to crop the visualization to the region of interest (requires a ROI to be set for the</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a><span class="sd">            slide beforehand with the [set_roi][prismtoolbox.wsicore.WSI.set_roi] method).</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a><span class="sd">        contours_color: The color to use for the contours.</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a><span class="sd">        line_thickness: The thickness to use for the contours</span>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a><span class="sd">        max_size: The maximum size for the visualization for the width or height of the image.</span>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a><span class="sd">        number_contours: Set to True to number the contours.</span>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a><span class="sd">        black_white: Set to True to visualize a binary mask of the contoured tissue.</span>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a><span class="sd">        view_slide_only: Set to True to visualize the slide only (without the contours).</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">        A PIL image of the visualization.</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a>    <span class="k">assert</span> <span class="n">line_thickness</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;line_thickness must be greater than 0&quot;</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>    <span class="n">scale</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">level_downsamples</span><span class="p">[</span><span class="n">vis_level</span><span class="p">]</span>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a>    <span class="k">if</span> <span class="n">black_white</span><span class="p">:</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_thumbnail</span><span class="p">(</span><span class="n">vis_level</span><span class="p">,</span> <span class="n">crop_roi</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>        <span class="n">line_thickness</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>        <span class="n">contours_color</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">create_thumbnail</span><span class="p">(</span><span class="n">vis_level</span><span class="p">,</span> <span class="n">crop_roi</span><span class="p">))</span>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a>        <span class="n">line_thickness</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line_thickness</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">view_slide_only</span><span class="p">:</span>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a>            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a>                <span class="sa">f</span><span class="s2">&quot;No tissue contours found for the slide </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">slide_name</span><span class="si">}</span><span class="s2">, please run the detect_tissue method first.&quot;</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a>            <span class="p">)</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="k">if</span> <span class="n">crop_roi</span><span class="p">:</span>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>                    <span class="s2">&quot;ROI is not set for the slide, please set the ROI with the set_roi method.&quot;</span>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a>                <span class="p">)</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>            <span class="n">offset</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ROI</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>            <span class="n">offset</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>        <span class="n">contours</span> <span class="o">=</span> <span class="p">[</span><span class="n">cont</span> <span class="o">-</span> <span class="n">offset</span> <span class="k">for</span> <span class="n">cont</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">tissue_contours</span><span class="p">]</span>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>        <span class="n">contours</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scale_contours</span><span class="p">(</span><span class="n">contours</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">contours</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">number_contours</span><span class="p">:</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>                <span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>                    <span class="n">img</span><span class="p">,</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>                    <span class="n">contours</span><span class="p">,</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>                    <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>                    <span class="n">contours_color</span><span class="p">,</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>                    <span class="n">line_thickness</span><span class="p">,</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                    <span class="n">lineType</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">LINE_8</span><span class="p">,</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>                <span class="p">)</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>            <span class="k">else</span><span class="p">:</span>  <span class="c1"># add numbering to each contour</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>                <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">cont</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">contours</span><span class="p">):</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>                    <span class="n">M</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">moments</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>                    <span class="n">cX</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="s2">&quot;m10&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="s2">&quot;m00&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-9</span><span class="p">))</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>                    <span class="n">cY</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="s2">&quot;m01&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">M</span><span class="p">[</span><span class="s2">&quot;m00&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-9</span><span class="p">))</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>                    <span class="c1"># draw the contour and put text next to center</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">drawContours</span><span class="p">(</span>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>                        <span class="n">img</span><span class="p">,</span>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>                        <span class="p">[</span><span class="n">cont</span><span class="p">],</span>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>                        <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a>                        <span class="n">contours_color</span><span class="p">,</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a>                        <span class="n">line_thickness</span><span class="p">,</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>                        <span class="n">lineType</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">LINE_8</span><span class="p">,</span>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a>                    <span class="p">)</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a>                    <span class="n">cv2</span><span class="o">.</span><span class="n">putText</span><span class="p">(</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a>                        <span class="n">img</span><span class="p">,</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>                        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">idx</span><span class="p">),</span>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a>                        <span class="p">(</span><span class="n">cX</span><span class="p">,</span> <span class="n">cY</span><span class="p">),</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>                        <span class="n">cv2</span><span class="o">.</span><span class="n">FONT_HERSHEY_SIMPLEX</span><span class="p">,</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>                        <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>                        <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>                        <span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>    <span class="k">if</span> <span class="n">black_white</span><span class="p">:</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>    <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">size</span>
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>    <span class="k">if</span> <span class="n">max_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="n">w</span> <span class="o">&gt;</span> <span class="n">max_size</span> <span class="ow">or</span> <span class="n">h</span> <span class="o">&gt;</span> <span class="n">max_size</span><span class="p">):</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>        <span class="n">resizeFactor</span> <span class="o">=</span> <span class="n">max_size</span> <span class="o">/</span> <span class="n">w</span> <span class="k">if</span> <span class="n">w</span> <span class="o">&gt;</span> <span class="n">h</span> <span class="k">else</span> <span class="n">max_size</span> <span class="o">/</span> <span class="n">h</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">resizeFactor</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">resizeFactor</span><span class="p">)))</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>    <span class="k">return</span> <span class="n">img</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="prismtoolbox.wsicore.wsi.WSI.worker_init" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-method"></code>          <code class="highlight language-python"><span class="n">worker_init</span><span class="p">(</span><span class="n">slide_path</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Initialize the worker process with a wsi object.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>slide_path</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the slide.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>engine</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The backend library to use for reading the slide (currently only openslide
and tiffslide are supported)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/prismtoolbox/wsicore/wsi.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="k">def</span> <span class="nf">worker_init</span><span class="p">(</span><span class="n">slide_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">engine</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Initialize the worker process with a wsi object.</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        slide_path: The path to the slide.</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        engine: The backend library to use for reading the slide (currently only openslide</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">            and tiffslide are supported)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">global</span> <span class="n">wsi</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="n">wsi</span> <span class="o">=</span> <span class="n">WSI</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">slide_path</span><span class="p">,</span> <span class="n">engine</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../../../../api_index/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Overview" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Overview
            </div>
          </div>
        </a>
      
      
        
        <a href="../core_utils/" class="md-footer__link md-footer__link--next" aria-label="Next: prismtoolbox.wsicore.core_utils" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              prismtoolbox.wsicore.core_utils
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023 - 2024 Loïc Le Bescond
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.indexes", "toc.integrate", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
    
  </body>
</html>